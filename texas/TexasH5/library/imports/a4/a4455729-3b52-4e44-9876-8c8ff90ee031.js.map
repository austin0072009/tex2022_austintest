{"version":3,"sources":["assets\\Script\\modules\\@slotsmaster\\ui-common\\lib\\MgrOrder.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { AppConst } from \"./AppConst\";\nimport HttpApi, { Http_GetOrder } from \"./HttpApi\";\n\n/*\n * @Description:\n * @Author: 张菊\n * @Date: 2020-05-14 14:21:05\n * @LastEditTime: 2020-05-14 18:14:47\n * @LastEditors: 张菊\n */\nexport class MgrOrder {\n    private _getDataInfo = null;\n    private _callbackSuccess: Function;\n    private _callbackFail: Function;\n    protected static instance: MgrOrder;\n    public static getInstance(): MgrOrder {\n        if (!this.instance) {\n            this.instance = new MgrOrder();\n        }\n        return this.instance;\n    }\n    //服务器已请求订单\n    createdOrderToJava(data: any) {\n        if (data.orderId) {\n            AppConst.orderId = data.orderId.toString();\n            if (AppConst.platform == \"iOS\") {\n                console.log(\"jhl jsToIos:\", data);\n                jsb.reflection.callStaticMethod(\"AppController\", \"Pay:chargeData:\", data.orderId, data.productCode);\n            } else if ((AppConst.platform = \"Android\")) {\n                //  let productCode = Tools.changeToLowercase(data.productCode);\n                //安卓支付\n                console.log(\"jhl jsToAndroid:\", data);\n                jsb.reflection.callStaticMethod(\n                    \"org/cocos2dx/javascript/AppActivity\",\n                    \"GooglePay\",\n                    \"(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;\",\n                    data.orderId,\n                    data.productCode\n                );\n            }\n            return true;\n        } else {\n            return false;\n        }\n    }\n    async postData(url: string, bodyParams: any, callback: Function): Promise<any> {\n        let result: any = await HttpApi.http.post(HttpApi.server + url, bodyParams, {\n            headers: {\n                Authorization: AppConst.accessToken,\n            },\n        });\n        console.log(\"postDatapostData:\", result);\n        if (result.isSuccessful) {\n            this._getDataInfo = result.data;\n            callback();\n        }\n    }\n    getOrderSuccessCallBack(): void {\n        AppConst.orderId = \"\";\n        //cc.cdd.MyApp.tip(\"創建訂單成功！\");\n        let self = MgrOrder.getInstance();\n        AppConst.orderId = self._getDataInfo.orderId;\n        if (self._getDataInfo.productCode) {\n            if (AppConst.platform == \"iOS\") {\n                console.log(\"jhl jsToIos:\", self._getDataInfo);\n                jsb.reflection.callStaticMethod(\n                    \"AppController\",\n                    \"Pay:chargeData:\",\n                    self._getDataInfo.orderId,\n                    self._getDataInfo.productCode\n                );\n            } else if (AppConst.platform == \"Android\") {\n                //   let productCode = Tools.changeToLowercase(ret.data.productCode);\n                //安卓支付\n                console.log(\"jhl jsToAndroid:\", self._getDataInfo);\n                jsb.reflection.callStaticMethod(\n                    \"org/cocos2dx/javascript/AppActivity\",\n                    \"GooglePay\",\n                    \"(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;\",\n                    self._getDataInfo.orderId,\n                    self._getDataInfo.productCode\n                );\n            }\n        }\n    }\n\n    sendOrderToJava(data: any, callbackSuccess: Function, callbackFail) {\n        this._callbackSuccess = callbackSuccess;\n        this._callbackFail = callbackFail;\n        //  cc.cdd.MgrUser.orderData = data;\n        if (this.createdOrderToJava(data)) return;\n        var self = this;\n        console.log(\" sendOrderToJava___________\", data);\n        let url: string = Http_GetOrder;\n        let bodyParams: any = {\n            productId: data.productId,\n            quantity: data.quantity,\n        };\n        if (cc.sys.os == cc.sys.OS_IOS) {\n            localStorage.getItem(\"iosPay\") != undefined &&\n            localStorage.getItem(\"iosPay\") != null &&\n            AppConst.orderId != \"\"\n                ? this.checkNoCannelPay()\n                : this.postData(url, bodyParams, this.getOrderSuccessCallBack);\n        } else if (cc.sys.os == cc.sys.OS_ANDROID) {\n            localStorage.getItem(\"AndroidPay\") != undefined &&\n            localStorage.getItem(\"AndroidPay\") != null &&\n            AppConst.orderId != \"\"\n                ? this.checkNoCannelPay()\n                : this.postData(url, bodyParams, this.getOrderSuccessCallBack);\n        } else {\n            this.postData(url, bodyParams, this.getOrderSuccessCallBack);\n        }\n    }\n    getPayDataSuccessCallBack(): void {\n        let self = MgrOrder.getInstance();\n        console.log(\"充值服务器返回数据：\", JSON.stringify(self._getDataInfo));\n        if (self._getDataInfo.verified == true) {\n            console.log(\"充值服务器返回数据：\", JSON.stringify(self._getDataInfo));\n            self._callbackSuccess();\n\n            // cc.cdd.MyApp.tip(\"充值成功\");\n            //   cc.cdd.MyApp.alert(\"THANK YOU\", TipsConst.Recharge_Success, function() {}, 1, 3);\n            // if (cc.cdd.MgrUser.getFirstCharge() == 1) {\n            //     cc.cdd.MgrUser.setFirstCharge(0);\n            //     cc.director.GlobalEvent.emit(\"hall_firstCharge\");\n            // }\n            // self.paySuccessAllState();\n            self.checkPayState();\n        } else {\n            self._callbackFail();\n            //cc.cdd.MyApp.tip(\"验证失败\");\n            // cc.cdd.MyApp.alert(\n            //     \"SORRY\",\n            //     TipsConst.Recharge_Fail,\n            //     function() {\n            //         self.payFailAllState();\n            //     },\n            //     1,\n            //     2,\n            //     1\n            // );\n        }\n        // } else {\n        //     //cc.cdd.MyApp.warning(\"充值失敗\");\n        //     // cc.cdd.MyApp.alert(\n        //     //     \"SORRY\",\n        //     //     TipsConst.Recharge_Fail,\n        //     //     function() {\n        //     //         self.payFailAllState();\n        //     //     },\n        //     //     1,\n        //     //     2,\n        //     //     1\n        //     // );\n    }\n\n    sendPayData(obj, data) {\n        let payData;\n        if (cc.sys.os == cc.sys.OS_IOS) {\n            payData = AppConst.orderId + \";\" + obj + \";\" + \"false\";\n            localStorage.setItem(\"iosPay\", payData);\n        } else if (cc.sys.os == cc.sys.OS_ANDROID) {\n            payData = obj + \"&\" + \"false\";\n            localStorage.setItem(\"AndroidPay\", payData);\n        }\n        let url = Http_GetOrder;\n        let bodyParams: any = {\n            productId: data.productId,\n            quantity: data.quantity,\n        };\n        this.postData(url, bodyParams, this.getPayDataSuccessCallBack);\n    }\n\n    checkNoCannelPay() {\n        var arr;\n        var newArr;\n        if (cc.sys.os == cc.sys.OS_IOS) {\n            arr = localStorage.getItem(\"iosPay\");\n            newArr = arr.split(\";\");\n        } else if (cc.sys.os == cc.sys.OS_ANDROID) {\n            arr = localStorage.getItem(\"AndroidPay\");\n            newArr = arr.split(\"&\");\n        }\n        console.log(\"检测未完成订单1：\", JSON.stringify(arr));\n        //cc.cdd.MyApp.tip(\"檢測未完成訂單,繼續進行充值操作\");\n        console.log(\"检测未完成订单2：\", JSON.stringify(newArr));\n        console.log(\"检测未完成订单3：\", newArr[newArr.length - 1]);\n        if (newArr[newArr.length - 1] == \"false\") {\n            if (cc.sys.os == cc.sys.OS_IOS) {\n                var obj = newArr[1] + \";\" + newArr[2] + \";\" + newArr[0];\n                console.log(\"检测未完成订单：\" + obj);\n                this.iosPayBack(obj, 1);\n            } else if (cc.sys.os == cc.sys.OS_ANDROID) {\n                var obj = newArr[0] + \"&\" + newArr[1] + \"&\" + newArr[2] + \"&\" + newArr[3];\n                console.log(\"检测未完成订单：\" + obj);\n                this.AndroidGooglePay(obj, 1);\n            }\n        }\n    }\n    iosPayBack(obj: any, type = 0) {\n        var obrArr = obj.split(\";\");\n        console.log(\"Ios支付数据：\" + obrArr);\n        var curOrderId = \"\";\n        type == 0 ? (curOrderId = AppConst.orderId) : (curOrderId = obrArr[2]);\n        var data = {\n            orderId: curOrderId,\n            payType: \"Apple\",\n            payment: obrArr[0],\n            signature: \"\",\n            transactionId: obrArr[1],\n        };\n        this.sendPayData(obj, data);\n    }\n\n    //谷歌安卓支付\n    AndroidGooglePay(obj, type = 0) {\n        console.log(\"Android支付数据：\" + obj);\n        var obrArr = obj.split(\"&\");\n        console.log(\"Android支付数据：\" + obrArr);\n        var curOrderId = \"\";\n        type == 0 ? (curOrderId = AppConst.orderId) : (curOrderId = obrArr[0]);\n        var data = {\n            orderId: curOrderId,\n            payType: \"Google\",\n            payment: obrArr[1],\n            transactionId: obrArr[2],\n            signature: obrArr[3],\n        };\n        this.sendPayData(obj, data);\n    }\n\n    //检测订单校验情况\n    checkPayState() {\n        var arr;\n        var newArr;\n        if (cc.sys.os == cc.sys.OS_IOS) {\n            arr = localStorage.getItem(\"iosPay\");\n            newArr = arr.split(\";\");\n            if (newArr[newArr.length - 1] == \"false\" && newArr[0] == AppConst.orderId) {\n                localStorage.removeItem(\"iosPay\");\n            }\n        } else if (cc.sys.os == cc.sys.OS_ANDROID) {\n            arr = localStorage.getItem(\"AndroidPay\");\n            newArr = arr.split(\"&\");\n            if (newArr[newArr.length - 1] == \"false\" && newArr[0] == AppConst.orderId) {\n                localStorage.removeItem(\"AndroidPay\");\n            }\n        }\n        console.log(\"检测订单：\", JSON.stringify(arr));\n    }\n}\n"]}