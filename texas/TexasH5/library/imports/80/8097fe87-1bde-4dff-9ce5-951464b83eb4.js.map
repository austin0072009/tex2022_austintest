{"version":3,"sources":["assets\\GameHall\\script\\Lobby\\redPacket\\redPacket.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { AudioManager } from \"../../../../Script/BaseFrame/AudioManager\";\nimport { CommonCtr } from \"../../../../Script/BaseFrame/CommonCtr\";\nimport ViewBase from \"../../../../Script/BaseFrame/ViewBase\";\nimport { UIUtil } from \"../../../../Script/Common/UIUtil\";\nimport { LoginViewCtr } from \"../../Login/LoginViewCtr\";\nimport { sc_extendredinfo } from \"../LobbyNetData\";\nimport LobbyViewCtr from \"../LobbyViewCtr\";\n\n/**\n * @description 推广红包\n */\nexport default class redPacket extends ViewBase {\n    protected get packageResourceName(): string {\n        return \"gameHall\";\n    }\n    protected get packageName(): string {\n        return \"res/Lobby\";\n    }\n    protected get componentName(): string {\n        return \"redPacketLayer\";\n    }\n\n    private ui_btn_break: fgui.GButton = null;\n    private ui_introduceNode: fgui.GComponent = null;\n    private ui_redpacketList: fgui.GList = null;\n    private ui_receivegold: fgui.GTextField = null;\n    private ui_noreceivegold: fgui.GTextField = null;\n\n    createChildComponents() {\n        super.createChildComponents();\n        this.fguiComponent.visible = false;\n    }\n\n    allChildCreated() {\n        super.allChildCreated();\n    }\n\n    OnLoadCompleted() {\n        this.ui_btn_break.onClick(() => {\n            AudioManager.Singleton.play('redPacket', \"button\");\n            this.Hide();\n        })\n\n        this.Show();\n    }\n\n    public Show() {\n        super.Show();\n        this.initData();\n    }\n\n    public Hide() {\n        super.Hide();\n    }\n\n    // 初始化\n    public initData() {\n        // 初始化介绍\n        this.initIntroduce();\n        // 初始化列表数据\n        this.initListData();\n    }\n\n    public initListData() {\n        this.ui_redpacketList.removeChildrenToPool();\n        let reddata: sc_extendredinfo = LobbyViewCtr.instance.Model.redpacketData;\n        let list = reddata.calist;\n        console.log(\"sc_extendredinfo === \", reddata);\n        // 设置显示已领取未领取\n        this.ui_receivegold.text = \"已领取：\" + UIUtil.formatNumber100(reddata.receivegold);\n        this.ui_noreceivegold.text = \"未领取：\" + UIUtil.formatNumber100(reddata.NoReceiveGold);\n        list.sort((a, b) => {\n            return a.IsReceive - b.IsReceive;\n        })\n        for (let index = 0; index < list.length; index++) {\n            let item = this.ui_redpacketList.addItemFromPool().asCom;\n            let data = list[index];\n            item.getChild(\"nickname\").asTextField.text = data.name + \"\";\n            item.getChild(\"userid\").asTextField.text = data.UserID + \"\";\n            item.getChild(\"goldnum\").asTextField.text = UIUtil.formatNumber100(reddata.gold) + \"\";\n            let isCanLQ: boolean = false;\n            let percent: number = Math.floor(data.income * 100 / reddata.agentTarget);\n            percent = percent > 100 ? 100 : percent;\n            item.getChild(\"percent\").asTextField.text = percent + \"%\";//UIUtil.formatNumber100(data.income) + \"/\" + UIUtil.formatNumber100(reddata.agentTarget);\n            let progressBar: fgui.GProgressBar = item.getChild(\"progressBar\").asProgress;\n            progressBar.value = percent;\n            isCanLQ = data.income >= reddata.agentTarget;\n            let btn_lq: fgui.GButton = item.getChild(\"btn_lingqu\").asButton;\n            item.getChild(\"statusText\").asTextField.visible = data.IsReceive != 0;\n            if (data.IsReceive == 0) {\n                if (isCanLQ) {\n                    btn_lq.clearClick();\n                    btn_lq.onClick(() => {\n                        this.sendReceiveGold(data.UserID);\n                    })\n                    btn_lq.node.runAction(cc.repeatForever(cc.sequence(cc.scaleTo(0.5, 0.3 * 0.9), cc.scaleTo(0.5, 0.3 * 1.1))));\n                } else {\n                    btn_lq.node.stopAllActions();\n                    btn_lq.scaleX = 0.3;\n                    btn_lq.scaleY = 0.3;\n                    btn_lq.enabled = false;\n                }\n            } else {\n                btn_lq.clearClick();\n                btn_lq.visible = false;\n            }\n\n        }\n    }\n\n    public initIntroduce() {\n        let reddata: sc_extendredinfo = LobbyViewCtr.instance.Model.redpacketData;\n        let des = reddata.des;\n        let desText: fgui.GTextField = this.ui_introduceNode.getChild(\"introduceText\").asTextField;\n        desText.text = des;\n    }\n\n    public sendReceiveGold(userid: number) {\n        AudioManager.Singleton.play('redPacket', \"button\");\n        let cidx: number = LoginViewCtr.instance.Model.cidx;\n        LobbyViewCtr.instance.cs_receiveextendgold(cidx, userid);\n    }\n\n    // 领取成功\n    public receiveSuccess() {\n        CommonCtr.instance.view.ShowTipLabel(\"領取成功\");\n        let cidx: number = LoginViewCtr.instance.Model.cidx;\n        LobbyViewCtr.instance.cs_extendredinfo(cidx);\n    }\n}"]}