{"version":3,"sources":["assets\\Script\\modules\\@slotsmaster\\ui-common\\lib\\TurnTable\\PublicTurnTable.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\n\nimport TurnTable from \"../TurnTable\";\nimport { MgrOrder } from \"../MgrOrder\";\nimport HttpApi, { Http_CreatForm, Http_GetVerifyPay } from \"../HttpApi\";\nimport { AppConst } from \"../AppConst\";\nimport { MogafaNumberField } from \"../../../../@mogafa/fairygui-component/lib/extensions/MogafaNumberField\";\nimport { Utils } from \"../../../../@mogafa/utils/lib/Utils\";\nimport SpinResultsGameWheel from \"../../../../spin-result/SpinResultsGameWheel\";\n\n\nexport class PublicTurnTable extends TurnTable {\n    protected get SpinButtonName(): string {\n        return \"Spin\";\n    }\n    protected get CollectButtonName(): string {\n        return \"Collect\";\n    }\n    protected get goldTurnData(): string[] {\n        return this.getWheelArray();\n    }\n    protected get goldTurnLabel(): string[] {\n        let labelArr: string[] = [];\n        for (let i = 1; i < 17; i++) {\n            labelArr.push(\"label\" + i);\n        }\n        return labelArr;\n    }\n    protected get packageResourceName(): string {\n        return \"Games/Common/UI/InGameTurntable/InGameTurntable\";\n    }\n    protected get packageName(): string {\n        return \"InGameTurntable\";\n    }\n    protected get componentName(): string {\n        return \"GameWheel\";\n    }\n    private resulText: fgui.GTextField;\n    private cmgpNumberField: MogafaNumberField;\n    private resultValue: number = 3;\n    private startValue: number = 10000;\n    private usd: number = 0.95;\n    private shineIndex: number = 1;\n    private scheduleShine = this.turnTableShine;\n    private productId: any;\n    private productCode: any;\n    private orderId: any;\n\n    protected createChildComponents() {\n        super.createChildComponents();\n        this.fguiComponent.visible = false;\n        this.fguiComponent.getChild(\"Close\").asButton.onClick(this.turnTableEnd, this);\n    }\n\n    protected finished() {\n        super.finished();\n        this.fguiComponent.getController(\"type\").selectedIndex = 1;\n        this.fguiComponent.getController(\"state\").selectedIndex = 1;\n        this.unschedule(this.scheduleShine);\n        this.fguiComponent.getChild(\"getGold\").asLabel.text = \"\" + this.resultValue;\n        let turnResult = this.fguiComponent.getChild(\"getMoreGold\");\n        let result = this.startValue * this.resultValue;\n        this.cmgpNumberField = turnResult.asMogafaNumberField();\n        this.cmgpNumberField.play(0, result, 2);\n    }\n\n    private setResulText(value: string) {\n        if (value) {\n            if (this.resulText) {\n                this.resulText.text = Utils.formatNumberToInt(value) + \" X\";\n            }\n        }\n    }\n\n    private turnTableEnd() {\n        if (this.wheelFinishedCallback) {\n            this.wheelFinishedCallback();\n        }\n        this.fguiComponent.node.zIndex = 0;\n        this.Hide();\n    }\n\n    public onShow(callBack: Function, wheelData: SpinResultsGameWheel) {\n        super.onShow(callBack, wheelData);\n        this.gameWheel = wheelData;\n        this.fguiComponent.visible = true;\n        this.fguiComponent.node.zIndex = 999;\n        this.fguiComponent.getController(\"type\").selectedIndex = 0;\n        this.onWheelOpen();\n        this.resulText = this.fguiComponent.getChild(\"Gold\").asTextField;\n        if (this.gameWheel) {\n            this.startValue = this.gameWheel.winCoins;\n            this.resultValue = this.gameWheel.wheel.finalValue.value;\n            this.usd = this.gameWheel.productPrice;\n        }\n        this.fguiComponent.getChild(\"Spin\").asCom.getChild(\"value\").asLabel.text = \"USD \" + this.usd + \" SPIN\";\n        this.fguiComponent.getChild(\"getMoreGold\").asLabel.text = \"\";\n        this.setResulText(\"\" + this.startValue);\n        this.initData(\"\" + this.resultValue, 0);\n    }\n\n    protected startTurn() {\n        super.startTurn();\n        this.fguiComponent.getController(\"type\").selectedIndex = 2;\n        this.shineIndex = 1;\n        this.schedule(this.scheduleShine, 0.1);\n    }\n\n    protected onClickGetSpin() {\n        let data = {\n            productCode: this.productCode,\n            productId: this.productId,\n            quantity: 1,\n        };\n        MgrOrder.getInstance().sendOrderToJava(data, this.buySuccess, this.buyFailed);\n    }\n\n    private buySuccess() {\n        this.StartSpin();\n    }\n\n    private buyFailed() {\n        //  UIMgr.getInstance().showTipView(this, 0, \"Payment result\", \"Purchase failed\");\n    }\n\n    private shineHide() {\n        for (let i = 1; i < 16; i++) {\n            this.fguiComponent.getChild(\"light_\" + i).visible = false;\n        }\n    }\n\n    private turnTableShine() {\n        if (this.shineIndex < 16) {\n            this.shineHide();\n            this.fguiComponent.getChild(\"light_\" + this.shineIndex).visible = true;\n        }\n        this.shineIndex++;\n        if (this.shineIndex > 15) {\n            this.shineIndex = 1;\n        }\n    }\n\n    private getWheelArray() {\n        if (this.gameWheel) {\n            let wheelValues = this.gameWheel.wheel.values;\n            let values = [];\n            for (const i in wheelValues) {\n                values.push(\"\" + wheelValues[i].value);\n            }\n            return values;\n        }\n        return [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\", \"11\", \"12\", \"13\", \"14\", \"15\", \"16\"];\n    }\n\n    private onWheelOpen() {\n        let productId = this.gameWheel ? this._gameWheel.productId : \"112358\";\n        HttpApi.http\n            .post(\n                HttpApi.server + Http_CreatForm + `?${`productId=${productId}&quantity=${1}`}`,\n                {},\n                {\n                    headers: {\n                        // 'Content-Type': \"application/json\",\n                        Authorization: AppConst.accessToken,\n                    },\n                }\n            )\n            .then(\n                (res: any) => {\n                    console.log(res);\n                    if (res.code == 200) {\n                        this.productCode = res.data.productCode;\n                        this.productId = res.data.productId;\n                        this.orderId = res.data.orderId;\n                    }\n                },\n                (err) => { }\n            )\n            .catch((err) => { });\n    }\n}\n"]}