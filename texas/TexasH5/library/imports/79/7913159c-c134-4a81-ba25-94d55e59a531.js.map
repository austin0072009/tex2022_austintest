{"version":3,"sources":["assets\\GameHall\\script\\Lobby\\Components\\BroadcastView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ViewBase from \"../../../../Script/BaseFrame/ViewBase\";\r\nimport { BaseFrameNative } from \"../../../../Script/BaseFrameNative\";\r\nimport { notice } from \"../LobbyNetData\";\r\nimport { BroadcastViewCtr } from \"./BroadcastViewCtr\";\r\n\r\nexport class BroadcastView extends ViewBase {\r\n    protected get packageResourceName(): string {\r\n        return \"GameCommon\";\r\n    }\r\n    protected get packageName(): string {\r\n        return \"Common\";\r\n    }\r\n    protected get componentName(): string {\r\n        return \"Broadcast\";\r\n    }\r\n    createChildComponents() {\r\n        super.createChildComponents();\r\n        this.fguiComponent.node.opacity = 0;\r\n        this.fguiComponent.sortingOrder = 9999;\r\n        BroadcastViewCtr.instance.view = this;\r\n    }\r\n\r\n    OnLoadCompleted() {\r\n        this.isOpend = false;\r\n        this.loopNotice();\r\n    }\r\n\r\n    private ui_textLabel: fgui.GRichTextField = null;\r\n\r\n    public messages: string[] = [];\r\n    private noticelist: notice[] = [];\r\n    /**开始的时间 */\r\n    private startTime: number;\r\n    /**结束的时间 */\r\n    private endTime: number;\r\n    /**公告的内容 */\r\n    private content: string;\r\n    private nowIndex: number = 0;\r\n\r\n    /**是否正在广播 */\r\n    private isOpend: boolean = false;\r\n    private delayTime: number = 0;\r\n\r\n    public addMessage(str: string, delayTime = 0) {\r\n        if (this.messages.includes(str) || this.ui_textLabel.text == str) {\r\n            console.log(\"Broadcast addMessage 已有\");\r\n            return;\r\n        }\r\n        this.messages.push(str);\r\n        this.delayTime = delayTime;\r\n        if (!this.isOpend) {\r\n            this.showBroadcast();\r\n        }\r\n    }\r\n\r\n    public loopNotice() {\r\n        this.noticelist = BaseFrameNative.broadnotice;\r\n        if (this.noticelist.length <= 0) {\r\n            return;\r\n        }\r\n        this.Show();\r\n        this.content = this.noticelist[this.nowIndex].content;\r\n        this.startTime = new Date(this.noticelist[this.nowIndex].starttime).getTime();\r\n        this.endTime = new Date(this.noticelist[this.nowIndex].endtime).getTime();\r\n\r\n        this.node.runAction(\r\n            cc.sequence(\r\n                cc.delayTime(3),\r\n                cc.callFunc(() => {\r\n                    if (this.noticelist.length <= 0) {\r\n                        return;\r\n                    }\r\n                    let now = Date.now();\r\n                    this.nowIndex += 1;\r\n                    if ((now >= this.startTime && now <= this.endTime) || this.endTime < 0) {\r\n                        this.addMessage(this.content);\r\n                        // this.showBroadcast();\r\n                    } else {\r\n                        this.noticelist.splice(this.nowIndex, 1);\r\n                    }\r\n                    if (this.nowIndex > this.noticelist.length - 1) {\r\n                        this.nowIndex = 0;\r\n                        this.loopNotice();\r\n                    }\r\n                })))\r\n    }\r\n\r\n    private showBroadcast() {\r\n        let mess = this.messages.shift();\r\n        if (!mess) {\r\n            this.isOpend = false;\r\n            this.fguiComponent.node.opacity = 0;\r\n            return;\r\n        }\r\n        this.isOpend = true;\r\n        this.ui_textLabel.text = mess;\r\n        this.ui_textLabel.node.x = this.fguiComponent.width;\r\n        this.ui_textLabel.node.runAction(\r\n            cc.sequence(\r\n                cc.delayTime(3 + this.delayTime),\r\n                cc.callFunc(() => { (this.fguiComponent.node.opacity != 255) && (this.fguiComponent.node.opacity = 255) }),\r\n                cc.moveBy(8, cc.v2(-(this.ui_textLabel.node.width + this.fguiComponent.width), 0)),\r\n                cc.callFunc(() => {\r\n                    this.ui_textLabel.text = '';\r\n                    this.isOpend = false;\r\n                    this.Hide();\r\n                    this.loopNotice();\r\n                }))\r\n        )\r\n    }\r\n\r\n    onDestroy() {\r\n        console.log(\"BroadcastView onDestroy\");\r\n        this.messages = [];\r\n        this.ui_textLabel.node.stopAllActions();\r\n    }\r\n}"]}