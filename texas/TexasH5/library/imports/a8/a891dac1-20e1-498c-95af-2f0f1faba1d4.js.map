{"version":3,"sources":["assets\\Script\\HotUpdateManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { BaseFrameNative } from \"./BaseFrameNative\";\n\nconst jsb = (<any>window).jsb;\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class HotUpdateManager extends cc.Component {\n    private static manager: HotUpdateManager = null;\n\n    public static get instance(): HotUpdateManager {\n        this.manager = null;\n        if (this.manager == null) {\n            this.manager = new HotUpdateManager();\n            this.manager.onLoad();\n        }\n        return this.manager;\n    }\n\n    private _hallManifestAsset: string = \"\";\n\n    private _appLoad: any = null;\n    private _storagePath: string = '';\n    private _updateListener = null;\n    private _am: jsb.AssetsManager = null!;\n    private versionCompareHandle: (versionA: string, versionB: string) => number = null!;\n\n    checkCb(event: any) {\n        switch (event.getEventCode()) {\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\n                this.showTip(\"未找到本地配置文件，热更新失败！\");\n                break;\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\n                // this.showTip(\"下载更新配置文件失败！\");\n                break;\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\n                console.log(\"已经更新到最新的远程版本！\");\n                // 最新 不需要更新\n                if (this._updateListener) {\n                    this._updateListener();\n                }\n                break;\n            case jsb.EventAssetsManager.NEW_VERSION_FOUND:\n                // 大厅 不提示 直接更新\n                console.log(\"this._am.getTotalBytes() == \", this._am.getTotalBytes());\n                if (this._am.getTotalBytes() == 0) {\n                    if (this._updateListener) {\n                        this._updateListener();\n                    }\n                    return;\n                }\n                this._am.setEventCallback(null!);\n                setTimeout(() => {\n                    this.hotUpdate();\n                }, 200);\n                break;\n            default:\n                return;\n        }\n    }\n\n    updateCb(event: any) {\n        var failed = false;\n        var compelete = false;\n        console.log(\"event.getEventCode() === \", event.getEventCode());\n        switch (event.getEventCode()) {\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\n                // this.showTip('没有找到本地配置文件，跳过热更新！');\n                console.log('没有找到本地配置文件，跳过热更新！');\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.UPDATE_PROGRESSION:\n                console.log(event.getDownloadedFiles() + ' / ' + event.getTotalFiles());\n                console.log(event.getDownloadedBytes() + ' / ' + event.getTotalBytes());\n                let percent: number = event.getDownloadedBytes() / event.getTotalBytes();\n                let progress1 = Math.floor(event.getDownloadedBytes() / 1024) + 'kb';\n                let progress2 = Math.floor(event.getTotalBytes() / 1024) + \"kb\";\n                this.showTip('下载中: ' + progress1 + \"/\" + progress2);\n                if (isNaN(percent)) {\n                    percent = 0;\n                }\n                this._appLoad.percentLabel.string = Math.floor(percent * 100) + \"%\";\n                this._appLoad.percentNode.width = 1000 * percent;\n                break;\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\n                // this.showTip('无法下载manifest文件，热更新跳过！');\n                console.log('无法下载manifest文件，热更新跳过！');\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\n                // this.showTip('已经更新到最新的版本！');\n                console.log('已经更新到最新的版本！');\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.UPDATE_FINISHED:\n                compelete = true;\n                this._am.setEventCallback(null!);\n                this._updateListener = null;\n                break;\n            case jsb.EventAssetsManager.UPDATE_FAILED:\n                this.showTip('更新失败！！！');\n                console.log('Asset update error UPDATE_FAILED: ' + event.getAssetId() + ', ' + event.getMessage());\n                failed = true;\n                // 重新下载\n                break;\n            case jsb.EventAssetsManager.ERROR_UPDATING:\n                failed = true;\n                console.log('Asset update error ERROR_UPDATING: ' + event.getAssetId() + ', ' + event.getMessage());\n                this.showTip('更新失败！');\n                break;\n            case jsb.EventAssetsManager.ERROR_DECOMPRESS:\n                failed = true;\n                this.showTip(event.getMessage());\n                break;\n            default:\n                break;\n        }\n\n        if (failed) {\n            this._am.setEventCallback(null!);\n            this._updateListener = null;\n        }\n\n        if (compelete) {\n            let remoteVersion: string = this._am.getLocalManifest().getVersion();\n\n            var searchPaths = jsb.fileUtils.getSearchPaths();\n            var newPaths = this._am.getLocalManifest().getSearchPaths();\n            Array.prototype.unshift.apply(searchPaths, newPaths);\n            for (let index = 0; index < searchPaths.length; index++) {\n                const element = searchPaths[index];\n                this.addSearchPaths(element);\n            }\n            searchPaths = jsb.fileUtils.getSearchPaths();\n            cc.sys.localStorage.setItem('HotUpdateSearchPaths', JSON.stringify(searchPaths));\n\n            // Prepend the manifest's search path\n            // var searchPaths = jsb.fileUtils.getSearchPaths();\n            // var newPaths = this._am.getLocalManifest().getSearchPaths();\n            // console.log(JSON.stringify(newPaths));\n            // Array.prototype.unshift.apply(searchPaths, newPaths);\n            // This value will be retrieved and appended to the default search path during game startup,\n            // please refer to samples/js-tests/main.js for detailed usage.\n            // !!! Re-add the search paths in main.js is very important, otherwise, new scripts won't take effect.\n            // cc.sys.localStorage.setItem('HotUpdateSearchPaths', JSON.stringify(searchPaths));\n            // jsb.fileUtils.setSearchPaths(searchPaths);\n\n            console.log(`remoteVersion: ${remoteVersion}`);\n            // 热更新成功\n            BaseFrameNative.VERSION = remoteVersion;\n            cc.sys.localStorage.setItem(\"clientVersion\", remoteVersion);\n            // restart game.\n            this.showTip(\"重启游戏！\");\n            setTimeout(() => {\n                cc.game.restart();\n            }, 1000)\n        }\n    }\n\n    // 添加搜索路径\n    public addSearchPaths(path: string) {\n        let pathList = jsb.fileUtils.getSearchPaths();\n        for (let index = 0; index < pathList.length; index++) {\n            let tempPath = pathList[index];\n            if (tempPath == path) {\n                return;\n            }\n        }\n        // 没有加到搜索路径\n        pathList.unshift(path);\n        jsb.fileUtils.setSearchPaths(pathList);\n    }\n\n    loadCustomManifest() {\n        if (this._am.getState() === jsb.AssetsManager.State.UNINITED) {\n            let customManifestStr: string = \"\";\n            let manifestUrl = this.getGameManifest();\n            if (jsb.fileUtils.isFileExist(manifestUrl)) {\n                //存在版本控制文件 \n                customManifestStr = jsb.fileUtils.getStringFromFile(manifestUrl);\n            } else {\n                let url = BaseFrameNative.serverList.hotupdate_url;\n                if (this._hallManifestAsset != \"\") {\n                    customManifestStr = this._hallManifestAsset;\n                    console.log(\"this._texasManifestAsset === \", this._hallManifestAsset);\n                } else {\n                    customManifestStr = JSON.stringify({\n                        \"packageUrl\": url,\n                        \"remoteManifestUrl\": url + \"/manifest/project.manifest\",\n                        \"remoteVersionUrl\": url + \"/manifest/version.manifest\",\n                        \"version\": \"1.0.0\",\n                        \"assets\": {\n                        },\n                        \"searchPaths\": []\n                    });\n                }\n\n            }\n\n            var manifest = new jsb.Manifest(customManifestStr, this._storagePath);\n            this._am.loadLocalManifest(manifest, this._storagePath);\n        }\n    }\n\n    /**\n     * @description 获取子游戏manifest url\n     * @param gameName 子游戏名\n     * @returns manifest url\n     */\n    getGameManifest(): string {\n        let manifestRoot: string = \"\";\n        manifestRoot = (jsb.fileUtils ? jsb.fileUtils.getWritablePath() : \"/\") + \"HotUpdate/manifest/\";\n        return `${manifestRoot}/project.manifest`;\n    }\n\n    /**\n     * \n     * @param callback  检测到已是最新的回调\n     * @param appload   appLoad类，isHall为true才需要\n     */\n    checkUpdate(callback: Function, appload: any) {\n        this._updateListener = callback;\n        this._appLoad = appload;\n        this._storagePath = ((jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + 'HotUpdate/');\n        // this.loadCustomManifest();\n        // if (!this._am.getLocalManifest() || !this._am.getLocalManifest().isLoaded()) {\n        //     this.showTip(\"加载本地配置失败...\");\n        //     return;\n        // }\n        // this._am.setEventCallback(this.checkCb.bind(this));\n        // this._am.checkUpdate();\n        cc.resources.load(\"HallManifest/project\", jsb.Manifest, (err, manifest) => {\n            let manifest1: any = manifest;\n            this._hallManifestAsset = manifest1._nativeAsset;\n            this.loadCustomManifest();\n            if (!this._am.getLocalManifest() || !this._am.getLocalManifest().isLoaded()) {\n                this.showTip(\"加载本地配置失败...\");\n                return;\n            }\n            this._am.setEventCallback(this.checkCb.bind(this));\n            this._am.checkUpdate();\n        });\n    }\n\n    hotUpdate() {\n        if (this._am) {\n            this._am.setEventCallback(this.updateCb.bind(this));\n            this.loadCustomManifest();\n            this._am.update();\n        } else {\n            this.showTip(\"游戏更新中... \");\n        }\n    }\n\n    showTip(tip: string) {\n        this._appLoad.tipLabel.string = tip;\n    }\n\n    show() {\n        // if (this.updateUI.active === false) {\n        //     this.updateUI.active = true;\n        // }\n    }\n\n    // use this for initialization\n    onLoad() {\n        // Hot update is only available in Native build\n        if (!jsb) {\n            return;\n        }\n        console.log(\"--- HotUpdate onLoad ---\");\n        // Setup your own version compare handler, versionA and B is versions in string\n        // if the return value greater than 0, versionA is greater than B,\n        // if the return value equals 0, versionA equals to B,\n        // if the return value smaller than 0, versionA is smaller than B.\n        this.versionCompareHandle = function (versionA: string, versionB: string) {\n            console.log(\"JS Custom Version Compare: version A is \" + versionA + ', version B is ' + versionB);\n            var vA = versionA.split('.');\n            var vB = versionB.split('.');\n            for (var i = 0; i < vA.length; ++i) {\n                var a = parseInt(vA[i]);\n                var b = parseInt(vB[i] || '0');\n                if (a === b) {\n                    continue;\n                }\n                else {\n                    return a - b;\n                }\n            }\n            if (vB.length > vA.length) {\n                return -1;\n            }\n            else {\n                return 0;\n            }\n        };\n\n        this._storagePath = ((jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + 'HotUpdate/');\n        // Init with empty manifest url for testing custom manifest\n        this._am = new jsb.AssetsManager('', this._storagePath, this.versionCompareHandle);\n        // Setup the verification callback, but we don't have md5 check function yet, so only print some message\n        // Return true if the verification passed, otherwise return false\n        this._am.setVerifyCallback(function (path: string, asset: any) {\n            // 暂时不验证 JS校验太慢 要报错\n            // // When asset is compressed, we don't need to check its md5, because zip file have been deleted.\n            // var compressed = asset.compressed;\n            // // Retrieve the correct md5 value.\n            // var expectedMD5 = asset.md5;\n            // // asset.path is relative path and path is absolute.\n            // var relativePath = asset.path;\n            // // The size of asset file, but this value could be absent.\n            // var size = asset.size;\n            // if (compressed) {\n            // this.ShowTip(\"Verification passed : \" + relativePath);\n            //     return true;\n            // }\n            // else {\n            // this.ShowTip(\"Verification passed : \" + relativePath + ' (' + expectedMD5 + ')');\n            //     return true;\n            // }\n            return true;\n        });\n        // this.showTip('Hot update is ready, please check or directly update.');\n    }\n\n    onDestroy() {\n        if (this._updateListener) {\n            this._am.setEventCallback(null!);\n            this._updateListener = null;\n        }\n    }\n}\n"]}