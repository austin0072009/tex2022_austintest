{"version":3,"sources":["assets\\Script\\Common\\GiftView.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,kDAA6C;AAC7C,uCAAkC;AAElC;IAAA;QACI,cAAS,GAAW,EAAE,CAAA;QACtB,cAAS,GAAW,EAAE,CAAA;IAC1B,CAAC;IAAD,eAAC;AAAD,CAHA,AAGC,IAAA;AAHY,4BAAQ;AAKrB;IAAsC,4BAAQ;IAA9C;QAAA,qEA8JC;QApJU,SAAG,GAAW,CAAC,CAAC;QAChB,iBAAW,GAAa,IAAI,CAAC;QAE5B,aAAO,GAA0B,IAAI,GAAG,EAAoB,CAAC;QACrE,gFAAgF;QACxE,gBAAU,GAAO;YACrB,QAAQ,EAAE,EAAE,WAAW,EAAE,OAAO,EAAE,WAAW,EAAE,QAAQ,EAAE;YACzD,WAAW,EAAE,EAAE,WAAW,EAAE,IAAI,EAAE,WAAW,EAAE,KAAK,EAAE;YACtD,cAAc,EAAE,EAAE,WAAW,EAAE,IAAI,EAAE,WAAW,EAAE,MAAM,EAAE;YAC1D,eAAe,EAAE,EAAE,WAAW,EAAE,IAAI,EAAE,WAAW,EAAE,KAAK,EAAE;YAC1D,SAAS,EAAE,EAAE,WAAW,EAAE,MAAM,EAAE,WAAW,EAAE,EAAE,EAAE;YACnD,eAAe,EAAE,EAAE,WAAW,EAAE,IAAI,EAAE,WAAW,EAAE,KAAK,EAAE;YAC1D,aAAa,EAAE,EAAE,WAAW,EAAE,IAAI,EAAE,WAAW,EAAE,KAAK,EAAE;YACxD,aAAa,EAAE,EAAE,WAAW,EAAE,IAAI,EAAE,WAAW,EAAE,KAAK,EAAE;YACxD,YAAY,EAAE,EAAE,WAAW,EAAE,IAAI,EAAE,WAAW,EAAE,KAAK,EAAE;YACvD,kBAAkB,EAAE,EAAE,WAAW,EAAE,WAAW,EAAE,WAAW,EAAE,KAAK,EAAE;YACpE,YAAY,EAAE,EAAE,WAAW,EAAE,IAAI,EAAE,WAAW,EAAE,KAAK,EAAE;YACvD,aAAa,EAAE,EAAE,WAAW,EAAE,IAAI,EAAE,WAAW,EAAE,KAAK,EAAE;YACxD,aAAa,EAAE,EAAE,WAAW,EAAE,IAAI,EAAE,WAAW,EAAE,KAAK,EAAE;YACxD,aAAa,EAAE,EAAE,WAAW,EAAE,IAAI,EAAE,WAAW,EAAE,KAAK,EAAE;YACxD,SAAS,EAAE,EAAE,WAAW,EAAE,OAAO,EAAE,WAAW,EAAE,QAAQ,EAAE;YAC1D,MAAM,EAAE,EAAE,WAAW,EAAE,IAAI,EAAE,WAAW,EAAE,EAAE,EAAE;YAC9C,IAAI,EAAE,EAAE,WAAW,EAAE,OAAO,EAAE,WAAW,EAAE,QAAQ,EAAE;YACrD,WAAW,EAAE,EAAE,WAAW,EAAE,IAAI,EAAE,WAAW,EAAE,EAAE,EAAE;YACnD,KAAK,EAAE,EAAE,WAAW,EAAE,OAAO,EAAE,WAAW,EAAE,QAAQ,EAAE;YACtD,KAAK,EAAE,EAAE,WAAW,EAAE,IAAI,EAAE,WAAW,EAAE,EAAE,EAAE;SAChD,CAAA;;IA0HL,CAAC;IA7JG,sBAAc,yCAAmB;aAAjC;YACI,OAAO,YAAY,CAAC;QACxB,CAAC;;;OAAA;IACD,sBAAc,iCAAW;aAAzB;YACI,OAAO,QAAQ,CAAC;QACpB,CAAC;;;OAAA;IACD,sBAAc,mCAAa;aAA3B;YACI,OAAO,MAAM,CAAC;QAClB,CAAC;;;OAAA;IA6BD,wCAAqB,GAArB;QACI,iBAAM,qBAAqB,WAAE,CAAC;QAC9B,IAAI,CAAC,eAAe,CAAC,YAAY,CAAC,sBAAsB,EAAE,kBAAQ,CAAC,CAAC;QACpE,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC;QAC3C,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;IACpE,CAAC;IAEM,+BAAY,GAAnB,UAAoB,KAAa,EAAE,MAAe;QAC9C,IAAI,CAAC,QAAQ,CAAC,KAAK,GAAG,KAAK,CAAC;QAC5B,MAAM,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,MAAM,CAAC,CAAC;IAC9C,CAAC;IACD,kCAAe,GAAf;QACI,iBAAM,eAAe,WAAE,CAAC;QACxB,IAAI,CAAC,OAAO,EAAE,CAAC;IACnB,CAAC;IACM,0BAAO,GAAd;QAAA,iBA6CC;QA5CG,IAAI,CAAC,QAAQ,CAAC,oBAAoB,EAAE,CAAC;QACrC,IAAI,IAAI,GAAgB,EAAE,CAAC;QAC3B,IAAI,CAAC,OAAO,GAAG,IAAI,GAAG,EAAoB,CAAC;QAC3C,IAAI,MAAM,GAAG,EAAE,CAAC,YAAY,CAAC,SAAS,CAAC,YAAY,CAAC,CAAC;QACrD,MAAM,CAAC,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC,MAAM,EAAE,UAAC,GAAG,EAAE,MAAmB;YAC1D,IAAI,CAAC,GAAG,EAAE;gBACN,qBAAqB;gBAErB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;oBACpC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;wBAClB,SAAS;qBACZ;oBACD,IAAI,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,IAAI,OAAO,IAAI,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,IAAI,YAAY,IAAI,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,IAAI,gBAAgB,IAAI,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,IAAI,sBAAsB,IAAI,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,IAAI,OAAO,EAAE;wBAC5K,SAAS;qBACZ;oBAED,iBAAiB;oBACjB,gEAAgE;oBAChE,4DAA4D;oBAC5D,yBAAyB;oBACzB,2CAA2C;oBAC3C,oBAAoB;oBACpB,kCAAkC;oBAClC,wBAAwB;oBACxB,oCAAoC;oBACpC,mCAAmC;oBACnC,+BAA+B;oBAC/B,oCAAoC;oBACpC,mCAAmC;oBACnC,QAAQ;oBACR,kBAAkB;oBAClB,IAAI;oBACJ,sDAAsD;oBACtD,gCAAgC;oBAEhC,IAAI,QAAQ,GAAG,KAAI,CAAC,QAAQ,CAAC,eAAe,EAAc,CAAC;oBAC3D,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC7B,KAAI,CAAC,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;iBAC9C;gBACD,iEAAiE;gBACjE,mCAAmC;gBACnC,mDAAmD;aACtD;QACL,CAAC,CAAC,CAAC;IACP,CAAC;IAMM,8BAAW,GAAlB,UAAmB,IAAa,EAAE,MAAe;QAC7C,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;QACrB,IAAI,CAAC,UAAU,GAAG,MAAM,CAAC;IAC7B,CAAC;IAGD,QAAQ;IACD,8BAAW,GAAlB,UAAmB,IAAc;QAC7B,6CAA6C;QAC7C,+CAA+C;QAC/C,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;IAGpD,CAAC;IAEM,4BAAS,GAAhB,UAAiB,SAAkB,EAAE,WAAoB,EAAE,OAAe;QACtE,OAAO,CAAC,GAAG,CAAC,4BAA4B,CAAC,CAAC;QAC1C,IAAI,CAAC,QAAQ,GAAG,SAAS,CAAC;QAC1B,IAAI,CAAC,UAAU,GAAG,WAAW,CAAC;QAC9B,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,mBAAmB,EAAE,EAAE,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC;IAC5F,CAAC;IAED;;;;OAIG;IACI,0BAAO,GAAd,UAAe,IAAa,EAAE,MAAgB;QAC1C,IAAI,CAAC,IAAI;YAAE,OAAO;QAElB,IAAI,QAAQ,GAAW,MAAM,CAAC,SAAS,CAAC;QACxC,IAAI,QAAQ,GAAW,MAAM,CAAC,SAAS,CAAC;QAExC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;QAC/B,IAAI,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,QAAQ,CAAC,CAAC;QAC9C,IAAI,QAAQ,IAAI,EAAE,EAAE;YAChB,QAAQ,CAAC,YAAY,CAAC,CAAC,EAAE,QAAQ,EAAE,IAAI,CAAC,CAAC;YACzC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,oBAAoB,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,qBAAqB,CAAC,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC;YACrH,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAChC,IAAI,cAAc,GAAG,IAAI,CAAC,MAAM,CAAC,oBAAoB,CAAC,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,qBAAqB,CAAC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YAC9H,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE,CAAC,cAAc,CAAC,CAAC,EAAE,cAAc,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,QAAQ,CAAC;gBAC9F,QAAQ,CAAC,YAAY,CAAC,CAAC,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC;gBAC1C,QAAQ,CAAC,mBAAmB,CAAC;oBACzB,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;gBAC3C,CAAC,CAAC,CAAA;YACN,CAAC,CAAC,CAAC,CAAC,CAAC;SACR;aAAM;YACH,QAAQ,CAAC,YAAY,CAAC,CAAC,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC;YAC1C,QAAQ,CAAC,mBAAmB,CAAC;gBACzB,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;YAC3C,CAAC,CAAC,CAAA;SACL;IACL,CAAC;IAEL,eAAC;AAAD,CA9JA,AA8JC,CA9JqC,kBAAQ,GA8J7C","file":"","sourceRoot":"/","sourcesContent":["import ViewBase from \"../BaseFrame/ViewBase\";\nimport GiftItem from \"./GiftItem\";\n\nexport class JContent {\n    playAnima: string = \"\"\n    moveAnima: string = \"\"\n}\n\nexport default class GiftView extends ViewBase {\n    protected get packageResourceName(): string {\n        return \"GameCommon\";\n    }\n    protected get packageName(): string {\n        return \"Common\";\n    }\n    protected get componentName(): string {\n        return \"Gift\";\n    }\n    public Pos: number = 0;\n    public SendChatFun: Function = null;\n    private giftList: fgui.GList;\n    private giftMap: Map<string, GiftItem> = new Map<string, GiftItem>();\n    // private giftAnimaConfig: Map<string, JContent> = new Map<string, JContent>();\n    private giftConfig: {} = {\n        \"Tuoxie\": { \"playAnima\": \"21_To\", \"moveAnima\": \"21_Fly\" },\n        \"daoju_dao\": { \"playAnima\": \"To\", \"moveAnima\": \"Fly\" },\n        \"daoju_daquan\": { \"playAnima\": \"To\", \"moveAnima\": \"From\" },\n        \"daoju_laolong\": { \"playAnima\": \"To\", \"moveAnima\": \"Fly\" },\n        \"gunFrom\": { \"playAnima\": \"From\", \"moveAnima\": \"\" },\n        \"hd_bingtong01\": { \"playAnima\": \"To\", \"moveAnima\": \"Fly\" },\n        \"hd_daocha01\": { \"playAnima\": \"To\", \"moveAnima\": \"Fly\" },\n        \"hd_ganbei01\": { \"playAnima\": \"To\", \"moveAnima\": \"Fly\" },\n        \"hd_jidan01\": { \"playAnima\": \"To\", \"moveAnima\": \"Fly\" },\n        \"hd_jiguanqiang01\": { \"playAnima\": \"animation\", \"moveAnima\": \"fly\" },\n        \"hd_maobi01\": { \"playAnima\": \"To\", \"moveAnima\": \"Fly\" },\n        \"hd_meigui01\": { \"playAnima\": \"To\", \"moveAnima\": \"Fly\" },\n        \"hd_woshou01\": { \"playAnima\": \"To\", \"moveAnima\": \"Fly\" },\n        \"hd_zhuaji01\": { \"playAnima\": \"To\", \"moveAnima\": \"Fly\" },\n        \"hongbao\": { \"playAnima\": \"23_To\", \"moveAnima\": \"23_Fly\" },\n        \"kiss\": { \"playAnima\": \"15\", \"moveAnima\": \"\" },\n        \"mj\": { \"playAnima\": \"22_To\", \"moveAnima\": \"22_Fly\" },\n        \"xihongshi\": { \"playAnima\": \"18\", \"moveAnima\": \"\" },\n        \"yan\": { \"playAnima\": \"20_To\", \"moveAnima\": \"20_Fly\" },\n        \"zan\": { \"playAnima\": \"16\", \"moveAnima\": \"\" }\n    }\n\n    createChildComponents() {\n        super.createChildComponents();\n        fgui.UIObjectFactory.setExtension(\"ui://Common/GiftItem\", GiftItem);\n        this.giftList = this.getChild(\"n1\").asList;\n        this.giftList.on(fgui.Event.CLICK_ITEM, this.onClickItem, this);\n    }\n\n    public initListSize(width: number, height?: number) {\n        this.giftList.width = width;\n        height && (this.giftList.height = height);\n    }\n    allChildCreated() {\n        super.allChildCreated();\n        this.addGift();\n    }\n    public addGift() {\n        this.giftList.removeChildrenToPool();\n        let praf: cc.Prefab[] = [];\n        this.giftMap = new Map<string, GiftItem>();\n        let bundle = cc.assetManager.getBundle(\"GameCommon\");\n        bundle.loadDir(\"/Prefab\", cc.Prefab, (err, prefad: cc.Prefab[]) => {\n            if (!err) {\n                // let temp2: {} = {}\n\n                for (let i = 0; i < prefad.length; i++) {\n                    if (i == 1 || i == 2) {\n                        continue;\n                    }\n                    if (prefad[i].name == \"gunto\" || prefad[i].name == \"hd_dapao01\" || prefad[i].name == \"hd_dapao01_end\" || prefad[i].name == \"hd_jiguanqiang01_end\" || prefad[i].name == \"gunto\") {\n                        continue;\n                    }\n\n                    // // 获取动画名字 生成配置\n                    // let sk = cc.instantiate(prefad[i]).getComponent(sp.Skeleton);\n                    // let animations = sk.skeletonData.skeletonJson.animations;\n                    // let index: number = 0;\n                    // let jcontent: JContent = new JContent();\n                    // let temp: {} = {}\n                    // for (const key in animations) {\n                    //     if (index == 0) {\n                    //         jcontent.playAnima = key;\n                    //         temp[\"playAnima\"] = key;\n                    //     } else if (index == 1) {\n                    //         jcontent.moveAnima = key;\n                    //         temp[\"moveAnima\"] = key;\n                    //     }\n                    //     index += 1;\n                    // }\n                    // this.giftAnimaConfig.set(prefad[i].name, jcontent);\n                    // temp2[prefad[i].name] = temp;\n\n                    let listItem = this.giftList.addItemFromPool() as GiftItem;\n                    listItem.showGift(prefad[i]);\n                    this.giftMap.set(prefad[i].name, listItem);\n                }\n                // console.log(\"this.giftAnimaConfig == \", this.giftAnimaConfig);\n                // console.log(\"temp2 == \", temp2);\n                // console.log(\"temp2 == \", JSON.stringify(temp2));\n            }\n        });\n    }\n\n    private selfNode: cc.Node;\n    private targetNode: cc.Node;\n\n\n    public setFromNode(self: cc.Node, target: cc.Node) {\n        this.selfNode = self;\n        this.targetNode = target;\n    }\n\n    private ClickItem;\n    /**点击 */\n    public onClickItem(item: GiftItem) {\n        // this.parent.fguiComponent.visible = false;\n        // this.ClickItem = item.createAnimationNode();\n        this.SendChatFun(this.Pos, item.prefadAni.name);\n\n\n    }\n\n    public show_Gift(_selfNode: cc.Node, _targetNode: cc.Node, content: string) {\n        console.log(\"----giftview show_Gift----\");\n        this.selfNode = _selfNode;\n        this.targetNode = _targetNode;\n        this.flyGift(this.giftMap.get(content).createAnimationNode(), this.giftConfig[content]);\n    }\n\n    /**\n     * @description\n     * @param  自己的节点\n     * @param  目标的节点\n     */\n    public flyGift(node: cc.Node, m_list: JContent) {\n        if (!node) return;\n\n        let playName: string = m_list.playAnima;\n        let moveName: string = m_list.moveAnima;\n\n        this.targetNode.addChild(node);\n        let spineAni = node.getComponent(sp.Skeleton);\n        if (moveName != \"\") {\n            spineAni.setAnimation(0, moveName, true);\n            node.position = node.parent.convertToNodeSpaceAR(this.selfNode.parent.convertToWorldSpaceAR(this.selfNode.position));\n            node.setPosition(node.position);\n            let targetPosition = node.parent.convertToNodeSpaceAR(this.targetNode.parent.convertToWorldSpaceAR(this.targetNode.position));\n            node.runAction(cc.sequence(cc.moveTo(0.5, cc.v2(targetPosition.x, targetPosition.y)), cc.callFunc(() => {\n                spineAni.setAnimation(0, playName, false);\n                spineAni.setCompleteListener(() => {\n                    spineAni.node.parent.removeChild(node);\n                })\n            })));\n        } else {\n            spineAni.setAnimation(0, playName, false);\n            spineAni.setCompleteListener(() => {\n                spineAni.node.parent.removeChild(node);\n            })\n        }\n    }\n\n}"]}