{"version":3,"sources":["assets\\Games\\texas\\script\\View\\RollNotifierComp.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ViewBase from '../../../../Script/BaseFrame/ViewBase';\nimport F_TexasViewCtr from '../Contrl/F_TexasViewCtr';\nexport class RollNotifierComp extends ViewBase {\n    public ui_danMuBg: fgui.GComponent = null;\n    public ui_danMuTxt: fgui.GTextField = null;\n    public ui_danButton: fgui.GButton = null;\n\n    private mSpeed = 350.0;\n\n    private mNormalQueue: string[] = [];\n    private mIsPlaying: boolean;\n    private bgScreenHalfWidth: number;\n\n    private onLoadEnd: boolean = false;\n    OnLoadCompleted() {\n        this.onLoadEnd = true;\n        if (this.mystart) this.MyStartEx();\n    }\n\n    AutoSetGoProperty() { }\n\n    MyStart() {\n        this.mystart = true;\n        if (this.onLoadEnd) this.MyStartEx();\n    }\n\n    public MyStartEx() {\n        if(this.ui_danMuBg == null) super.AutoSetGoProperty();\n        this.mNormalQueue = [];\n        this.mIsPlaying = false;\n        this.bgScreenHalfWidth = cc.winSize.width;\n        // this.ui_danMuTxt.isCSF = true;\n        // gameObject.getOrAddComponent<CanvasGroup>().alpha = 1f;\n    }\n\n    public addNotify(content: string) {\n        if (this.ui_danButton.visible)\n            this.ui_danButton.visible = false;\n        this.fguiComponent.visible = true;\n        this.mNormalQueue.push(content);\n        if (!this.mIsPlaying) {\n            this.MoveEndCall();\n        }\n    }\n\n    public addVoicsNotify(title: string, content: string, pos: number) {\n        this.ui_danButton.clearClick();\n        this.ui_danButton.onClick(() => {\n            F_TexasViewCtr.instance.notifyPlayVoice(pos, content);\n        });\n        this.fguiComponent.visible = true;\n        this.mNormalQueue.push(title);\n        if (!this.mIsPlaying) {\n            this.MoveEndCall();\n        }\n    }\n    public DoMove() {\n        this.ui_danMuBg.node.stopAllActions();\n        this.mIsPlaying = true;\n        let time = ((this.bgScreenHalfWidth + this.danmuBgHalfLength) * 2) / this.mSpeed;\n\n        this.ui_danMuBg.node.runAction(cc.sequence(\n            cc.moveTo(time, cc.v2(-(this.bgScreenHalfWidth + this.danmuBgHalfLength), this.ui_danMuBg.node.y)),\n            cc.callFunc(() => {\n                this.MoveEndCall();\n            }),\n        ))\n    }\n\n    public MoveEndCall() {\n        if (this.fguiComponent == null) { return; }\n        this.ui_danMuBg.node.stopAllActions();\n        this.ResetOneText();\n        let isHaveNext = this.CheckAndSetCurShowText();\n        if (isHaveNext) {\n            this.DoMove();\n        }\n    }\n\n    private curShowStr: string;\n    private danmuBgHalfLength: number;\n\n    public CheckAndSetCurShowText(): boolean {\n        if (this.curShowStr != null) { return true; }\n        let str = this.mNormalQueue.length > 0 ? this.mNormalQueue.splice(this.mNormalQueue.length - 1, 1)[0] : null;\n        this.curShowStr = str;\n\n        if (this.curShowStr != null) {\n            this.fguiComponent.visible = true;\n            this.ui_danMuTxt.text = this.curShowStr;\n            this.danmuBgHalfLength = this.ui_danMuBg.getChild(\"bg\").width * 0.5;\n            this.ui_danMuBg.x = (this.bgScreenHalfWidth + this.danmuBgHalfLength);\n        }\n        else {\n            //没有新的用于显示的文本 则重置状态     \n            this.ResetPlayRoll();\n        }\n\n        return this.curShowStr != null;\n    }\n\n    public ResetPlayRoll() {\n        this.mIsPlaying = false;\n        this.fguiComponent.visible = false;\n    }\n\n    public ResetOneText() {\n        this.curShowStr = null;\n    }\n\n    private mImgScaleSpeed = 0.05;\n\n    public Hide() {\n        this.ResetPlayRoll();\n        super.Hide();\n    }\n\n}\n"]}