{"version":3,"sources":["assets\\GameHall\\script\\Lobby\\modifyLoginPwd\\ModifyLoginPwdView.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAA,0EAAyE;AACzE,oEAAmE;AACnE,0EAAyE;AACzE,kEAA6D;AAC7D,kFAAiF;AACjF,4EAAuE;AACvE,2FAA0F;AAC1F,sEAAqE;AAGrE;;GAEG;AACH;IAAgD,sCAAQ;IAAxD;QAAA,qEAwGC;QA7FW,6BAAuB,GAAiB,IAAI,CAAC;QAC7C,eAAS,GAAoB,IAAI,CAAC;QAClC,eAAS,GAAoB,IAAI,CAAC;QAClC,gBAAU,GAAoB,IAAI,CAAC;QACnC,mBAAa,GAAiB,IAAI,CAAC;QAcnC,UAAI,GAAY,KAAK,CAAC;;IA2ElC,CAAC;IAvGG,sBAAc,mDAAmB;aAAjC;YACI,OAAO,UAAU,CAAC;QACtB,CAAC;;;OAAA;IACD,sBAAc,2CAAW;aAAzB;YACI,OAAO,WAAW,CAAC;QACvB,CAAC;;;OAAA;IACD,sBAAc,6CAAa;aAA3B;YACI,OAAO,gBAAgB,CAAC;QAC5B,CAAC;;;OAAA;IAQD,kDAAqB,GAArB;QACI,iBAAM,qBAAqB,WAAE,CAAC;QAC9B,IAAI,CAAC,aAAa,CAAC,OAAO,GAAG,KAAK,CAAC;QACnC,IAAI,CAAC,uBAAuB,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;QAEtD,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;IAC3D,CAAC;IAED,iCAAI,GAAJ;QACI,2BAAY,CAAC,SAAS,CAAC,IAAI,CAAC,oBAAoB,EAAE,QAAQ,CAAC,CAAC;QAC5D,iBAAM,IAAI,WAAE,CAAC;IACjB,CAAC;IAGM,4CAAe,GAAtB;QAAA,iBA6DC;QA5DG,2BAAY,CAAC,SAAS,CAAC,IAAI,CAAC,oBAAoB,EAAE,QAAQ,CAAC,CAAC;QAC5D,IAAI,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC;QACjC,IAAI,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC;QACjC,IAAI,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC;QAEnC,IAAI,CAAC,MAAM,IAAI,CAAC,MAAM,IAAI,CAAC,OAAO,EAAE;YAChC,qBAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,CAAC;YAClD,OAAO;SACV;QACD,IAAI,MAAM,IAAI,OAAO,EAAE;YACnB,qBAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC;YACpD,OAAO;SACV;QACD,IAAI,GAAG,GAAG,EAAE,CAAC,GAAG,CAAC,YAAY,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;QACnD,IAAI,MAAM,IAAI,GAAG,EAAE;YACf,qBAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,CAAC;YAClD,OAAO;SACV;QACD,IAAI,MAAM,IAAI,MAAM,EAAE;YAClB,qBAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,CAAC;YAClD,OAAO;SACV;QACD,4BAA4B;QAC5B,yDAAyD;QACzD,cAAc;QACd,IAAI;QAEJ,IAAI,MAAM,GAAG;YACT,WAAW,EAAE,MAAM;YACnB,MAAM,EAAE,mBAAQ,CAAC,YAAY,CAAC,MAAM;SACvC,CAAC;QACF,IAAI,GAAG,GAAG,iCAAe,CAAC,cAAc,CAAC,SAAS,GAAG,qBAAqB,CAAC;QAC3E,IAAI,IAAI,CAAC,IAAI,EAAE;YACX,OAAO;SACV;QACD,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;QAChC,oBAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,EAAE,MAAM;QAChC,IAAI;QACJ,iBAAiB;QACjB,4DAA4D;QAC5D,QAAQ;QACR,IAAI;SACP;aACI,IAAI,CAAC,UAAC,GAAG;YACN,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC;YACjC,IAAI,GAAG,CAAC,IAAI,IAAI,CAAC,EAAE;gBACf,qBAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC;gBACpD,KAAI,CAAC,QAAQ,CAAC;oBACV,mCAAgB,CAAC,WAAW,CAAC,UAAU,EAAE,CAAC;oBAC1C,2BAAY,CAAC,SAAS,CAAC,SAAS,CAAC,UAAU,EAAE,OAAO,CAAC,CAAC;gBAC1D,CAAC,EAAE,CAAC,CAAC,CAAC;aACT;iBAAM;gBACH,qBAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;aACrD;QACL,CAAC,CAAC;aACD,KAAK,CAAC;YACH,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC;YACjC,qBAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC;QACnD,CAAC,CAAC,CAAA;IACV,CAAC;IAGD,4CAAe,GAAf;QACI,IAAI,CAAC,IAAI,EAAE,CAAC;IAChB,CAAC;IAEM,iCAAI,GAAX;QACI,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC;QAClB,iBAAM,IAAI,WAAE,CAAC;IACjB,CAAC;IAEL,yBAAC;AAAD,CAxGA,AAwGC,CAxG+C,kBAAQ,GAwGvD","file":"","sourceRoot":"/","sourcesContent":["import { AudioManager } from \"../../../../Script/BaseFrame/AudioManager\";\r\nimport { CommonCtr } from \"../../../../Script/BaseFrame/CommonCtr\";\r\nimport { SceneManager } from \"../../../../Script/BaseFrame/SceneManager\";\r\nimport ViewBase from \"../../../../Script/BaseFrame/ViewBase\";\r\nimport { WebSocketManager } from \"../../../../Script/BaseFrame/WebSocketManager\";\r\nimport HttpHelpEx from \"../../../../Script/Common/Managers/HttpHelpEx\";\r\nimport { AppConst } from \"../../../../Script/modules/@slotsmaster/ui-common/lib/AppConst\";\r\nimport { BaseFrameNative } from \"../../../../Script/BaseFrameNative\";\r\nimport { GameCommon } from \"../../GameCommon\";\r\n\r\n/**\r\n * @description 修改登錄密碼\r\n */\r\nexport default class ModifyLoginPwdView extends ViewBase {\r\n    protected get packageResourceName(): string {\r\n        return \"gameHall\";\r\n    }\r\n    protected get packageName(): string {\r\n        return \"res/Lobby\";\r\n    }\r\n    protected get componentName(): string {\r\n        return \"modifyLoginPwd\";\r\n    }\r\n\r\n    private ui_btn_modifyloginBreak: fgui.GButton = null;\r\n    private ui_oldPwd: fgui.GTextInput = null;\r\n    private ui_newPwd: fgui.GTextInput = null;\r\n    private ui_newPwd1: fgui.GTextInput = null;\r\n    private ui_btn_modify: fgui.GButton = null;\r\n\r\n    createChildComponents() {\r\n        super.createChildComponents();\r\n        this.fguiComponent.visible = false;\r\n        this.ui_btn_modifyloginBreak.onClick(this.Hide, this);\r\n\r\n        this.ui_btn_modify.onClick(this.changedLoginPwd, this);\r\n    }\r\n\r\n    Hide() {\r\n        AudioManager.Singleton.play('ModifyLoginPwdView', \"button\");\r\n        super.Hide();\r\n    }\r\n    private flag: boolean = false;\r\n\r\n    public changedLoginPwd() {\r\n        AudioManager.Singleton.play('ModifyLoginPwdView', \"button\");\r\n        let oldpwd = this.ui_oldPwd.text;\r\n        let newPwd = this.ui_newPwd.text;\r\n        let newPwd2 = this.ui_newPwd1.text;\r\n\r\n        if (!oldpwd || !newPwd || !newPwd2) {\r\n            CommonCtr.instance.view.ShowTipLabel(\"请检查是否填写完整\");\r\n            return;\r\n        }\r\n        if (newPwd != newPwd2) {\r\n            CommonCtr.instance.view.ShowTipLabel(\"两次输入的新密码不一致\");\r\n            return;\r\n        }\r\n        let pwd = cc.sys.localStorage.getItem(\"login_pwd\");\r\n        if (oldpwd != pwd) {\r\n            CommonCtr.instance.view.ShowTipLabel(\"输入的旧密码不正确\");\r\n            return;\r\n        }\r\n        if (oldpwd == newPwd) {\r\n            CommonCtr.instance.view.ShowTipLabel(\"新密码与旧密码一样\");\r\n            return;\r\n        }\r\n        // if (newPwd.length != 6) {\r\n        //     CommonCtr.instance.view.ShowTipLabel(\"新密码的格式不正确\");\r\n        //     return;\r\n        // }\r\n\r\n        let params = {\r\n            newpassword: newPwd,\r\n            userid: AppConst.mPlayerModel.userid,\r\n        };\r\n        let url = BaseFrameNative.serverlistItem.apiAdress + \"/api/Game/ChangePWD\";\r\n        if (this.flag) {\r\n            return;\r\n        }\r\n        this.flag = true;\r\n        fgui.GRoot.inst.showModalWait();\r\n        HttpHelpEx.instance.post(url, params\r\n            // {\r\n            //     headers: {\r\n            //         \"Content-Type\": \"application/json; charset=utf-8\"\r\n            //     }\r\n            // }\r\n        )\r\n            .then((res) => {\r\n                fgui.GRoot.inst.closeModalWait();\r\n                if (res.code == 0) {\r\n                    CommonCtr.instance.view.ShowTipLabel(\"修改成功，請重新登陸！\");\r\n                    this.schedule(() => {\r\n                        WebSocketManager.getInstance.DisConnect();\r\n                        SceneManager.Singleton.loadScene(\"gameHall\", \"login\");\r\n                    }, 1);\r\n                } else {\r\n                    CommonCtr.instance.view.ShowTipLabel(res.message);\r\n                }\r\n            })\r\n            .catch(() => {\r\n                fgui.GRoot.inst.closeModalWait();\r\n                CommonCtr.instance.view.ShowTipLabel(\"修改密码失败\");\r\n            })\r\n    }\r\n\r\n\r\n    OnLoadCompleted() {\r\n        this.Show();\r\n    }\r\n\r\n    public Show() {\r\n        this.flag = false;\r\n        super.Show();\r\n    }\r\n\r\n}"]}