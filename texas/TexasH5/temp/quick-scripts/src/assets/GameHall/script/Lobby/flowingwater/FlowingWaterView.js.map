{"version":3,"sources":["assets\\GameHall\\script\\Lobby\\flowingwater\\FlowingWaterView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { AudioManager } from \"../../../../Script/BaseFrame/AudioManager\";\r\nimport { CommonCtr } from \"../../../../Script/BaseFrame/CommonCtr\";\r\nimport ViewBase from \"../../../../Script/BaseFrame/ViewBase\";\r\nimport HttpHelpEx from \"../../../../Script/Common/Managers/HttpHelpEx\";\r\nimport { UIUtil } from \"../../../../Script/Common/UIUtil\";\r\nimport { AppConst } from \"../../../../Script/modules/@slotsmaster/ui-common/lib/AppConst\";\r\nimport { BaseFrameNative } from \"../../../../Script/BaseFrameNative\";\r\n\r\n/**\r\n * @description 我的流水\r\n */\r\nexport default class FlowingWaterView extends ViewBase {\r\n    protected get packageResourceName(): string {\r\n        return \"gameHall\";\r\n    }\r\n    protected get packageName(): string {\r\n        return \"res/Lobby\";\r\n    }\r\n    protected get componentName(): string {\r\n        return \"flowingwater\";\r\n    }\r\n\r\n    private ui_btn_waterBreak: fgui.GButton = null;\r\n    private ui_gameDown: fgui.GComboBox = null;\r\n    private ui_turnoverList: fgui.GList = null;\r\n\r\n    // private comboboxItem: string[] = [\"全部\", \"德州撲克\", \"德州牛仔\", \"龍虎\", \"忍者\", \"哪吒傳奇\",\r\n    //     \"九綫拉王\", \"宙斯\", \"火牛奇襲\", \"水果瑪麗\", \"財神過年\", \"火之女王\"];\r\n    private comboboxItemId: number[] = [0, 51, 104, 21, 201, 505, 92, 254, 4096, 91, 258, 54];\r\n\r\n    private comboboxItem: string[] = [\"全部\", \"帶入\", \"返還\", \"受贈\", \"贈送\", \"充值\", \"提現\"];\r\n    private changeType: number[] = [0, 33, 34, 7, 8, 10, 47];\r\n\r\n\r\n    private turnoverListData: { type: number, time: string, gameName: string, win: number }[] = [];\r\n\r\n    /**当前的页数 */\r\n    private pageIndex: number = 1;\r\n\r\n    /**当前数据的总数 */\r\n    private totalCount: number;\r\n    /**当前查询的游戏id */\r\n    private selectGameId: number = 0;\r\n    /**上次查询的游戏id */\r\n    private lastGameId: number;\r\n\r\n    /**選擇的類型 */\r\n    private selectChangType: number = 0;\r\n\r\n    createChildComponents() {\r\n        super.createChildComponents();\r\n        this.fguiComponent.visible = false;\r\n        this.ui_btn_waterBreak.onClick(this.Hide, this);\r\n        this.ui_gameDown.items = this.comboboxItem;\r\n        this.ui_turnoverList.setVirtual();\r\n        this.ui_turnoverList.itemRenderer = this.renderListItem.bind(this);\r\n        this.ui_turnoverList.on(fgui.Event.PULL_UP_RELEASE, this.onPullUpToRefresh, this);\r\n\r\n        this.ui_gameDown.on(fgui.Event.STATUS_CHANGED, this.onChanged, this);\r\n\r\n    }\r\n\r\n    OnLoadCompleted() {\r\n        this.Show();\r\n    }\r\n    Hide() {\r\n        AudioManager.Singleton.play('FlowingWaterView', \"button\");\r\n        super.Hide();\r\n    }\r\n\r\n    public renderListItem(index: number, obj: fgui.GObject) {\r\n        let item = <fgui.GComponent>obj;\r\n        let streamNum = item.getChild(\"n1\").asTextField;\r\n        let time = item.getChild(\"n2\").asTextField;\r\n        let gameName = item.getChild(\"n3\").asTextField;\r\n        let win = item.getChild(\"n4\").asTextField;\r\n        let color = item.getController(\"color\");\r\n\r\n        let str = '';\r\n        switch (this.turnoverListData[index].type) {\r\n            case 33:  //\r\n                str = '帶入';\r\n                break;\r\n            case 34:  //返还 \r\n                str = '返還';\r\n                break;\r\n            case 7:  //受赠\r\n                str = '受贈';\r\n                break;\r\n            case 8:  //赠送\r\n                str = '贈送';\r\n                break;\r\n            case 10:\r\n                str = '充值';\r\n                break;\r\n            case 47:\r\n                str = '提現';\r\n                break;\r\n            default:\r\n                str = '上下分';\r\n                break;\r\n        }\r\n\r\n        streamNum.text = str;\r\n\r\n        time.text = this.turnoverListData[index].time;\r\n        gameName.text = this.turnoverListData[index].gameName;\r\n        if (this.turnoverListData[index].win > 0) {\r\n            color.setSelectedIndex(0);\r\n            win.text = '+' + this.turnoverListData[index].win;\r\n        } else {\r\n            color.setSelectedIndex(1);\r\n            win.text = this.turnoverListData[index].win + '';\r\n        }\r\n    }\r\n\r\n    /**上刷新 */\r\n    public onPullUpToRefresh() {\r\n        if (!this.getDataBool) {\r\n            return;\r\n        }\r\n        // if (this.pageIndex * 20 > this.totalCount) {\r\n        //     return;\r\n        // }\r\n        this.pageIndex += 1;\r\n        this.getData();\r\n    }\r\n\r\n    /**是否可以获取数据 */\r\n    private getDataBool: boolean = true;\r\n\r\n    /**下拉狀態變化 */\r\n    public onChanged() {\r\n        AudioManager.Singleton.play('FlowingWaterView', \"button\");\r\n        // this.selectGameId = this.comboboxItemId[this.ui_gameDown.selectedIndex];\r\n        this.selectChangType = this.changeType[this.ui_gameDown.selectedIndex];\r\n        if (this.lastGameId == this.selectChangType) {\r\n            return;\r\n        }\r\n        this.turnoverListData = [];\r\n        this.pageIndex = 1;\r\n        this.getData();\r\n    }\r\n\r\n    public getData() {\r\n        if (!this.getDataBool) {\r\n            return;\r\n        }\r\n        this.getDataBool = false;\r\n        // CommonCtr.instance.ShowTipLabel(\"正在获取数据\");\r\n        let url = BaseFrameNative.serverlistItem.apiAdress + \"/api/gamelog/GetJackUserLog2\";\r\n        let params = {\r\n            PageSize: 20, //頁面大小\r\n            pageIndex: this.pageIndex, //页数\r\n            userid: AppConst.mPlayerModel.userid + '',\r\n            GameId: this.selectGameId,\r\n            changeType: this.selectChangType\r\n        };\r\n\r\n        HttpHelpEx.instance.post(url, params)\r\n            .then((res) => {\r\n                this.getDataBool = true;\r\n                cc.log(\"  ------res----\", res);\r\n                if (res.code == 1) {\r\n                    // this.pageIndex = res.data.pageIndex;\r\n                    // this.totalCount = res.data.totalCount;\r\n                    let data = res.data;\r\n                    if (this.lastGameId >= 0) {\r\n                        if (this.lastGameId != this.selectChangType) {\r\n                            this.turnoverListData = [];\r\n                        }\r\n                    } else {\r\n                        this.turnoverListData = [];\r\n                    }\r\n                    this.lastGameId = this.selectChangType;\r\n                    if (data.length > 0) {\r\n                        for (let i = 0; i < data.length; i++) {\r\n                            let info = { type: null, time: null, gameName: '', win: null };\r\n                            info.type = data[i].changeType; //类型\r\n                            info.time = data[i].time;  //时间\r\n                            info.gameName = data[i].gameName.split(\"≡\")[0];  //名字  \"財神過年≡God Of Wealth New Year\"\r\n                            info.win = UIUtil.formatNumber100(data[i].gold);  //金额\r\n                            this.turnoverListData.push(info);\r\n                        }\r\n                    } else {\r\n                        CommonCtr.instance.ShowTipLabel(\"暂无数据\");\r\n                    }\r\n                    this.ui_turnoverList.numItems = this.turnoverListData.length;\r\n                    this.ui_turnoverList.scrollPane.scrollBottom(true);\r\n                } else {\r\n                    CommonCtr.instance.ShowTipLabel(\"获取数据失败\");\r\n                }\r\n\r\n            })\r\n            .catch((err) => {\r\n                this.getDataBool = true;\r\n                cc.log(\"----------err---\", err)\r\n                CommonCtr.instance.ShowTipLabel(\"获取数据失败\");\r\n            })\r\n    }\r\n\r\n\r\n\r\n\r\n    public Show() {\r\n        this.turnoverListData = [];\r\n        this.ui_turnoverList.numItems = this.turnoverListData.length;\r\n        this.pageIndex = 1;\r\n        this.getData();\r\n        super.Show();\r\n    }\r\n\r\n}"]}