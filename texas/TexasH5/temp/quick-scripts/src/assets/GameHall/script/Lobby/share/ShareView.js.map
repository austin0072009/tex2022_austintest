{"version":3,"sources":["assets\\GameHall\\script\\Lobby\\share\\ShareView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { AudioManager } from \"../../../../Script/BaseFrame/AudioManager\";\r\nimport { CommonCtr } from \"../../../../Script/BaseFrame/CommonCtr\";\r\nimport ViewBase from \"../../../../Script/BaseFrame/ViewBase\";\r\nimport { AppConst } from \"../../../../Script/modules/@slotsmaster/ui-common/lib/AppConst\";\r\nimport { BaseFrameNative } from \"../../../../Script/BaseFrameNative\";\r\nimport NativeMethod from \"../../NativeMethod\";\r\nimport LobbyViewCtr from \"../LobbyViewCtr\";\r\nimport { QRCode } from \"./qrcode\";\r\n\r\n/**\r\n * @description 分享\r\n */\r\nexport default class ShareView extends ViewBase {\r\n    protected get packageResourceName(): string {\r\n        return \"gameHall\";\r\n    }\r\n    protected get packageName(): string {\r\n        return \"res/Lobby\";\r\n    }\r\n    protected get componentName(): string {\r\n        return \"share\";\r\n    }\r\n\r\n    private ui_btn_CommunityBreak: fgui.GButton = null;\r\n    /** */\r\n    private ui_btn_saveImg: fgui.GButton = null;\r\n\r\n    private ui_btn_copyLink: fgui.GButton = null;\r\n\r\n    private ui_shareUrl: fgui.GTextField = null;\r\n\r\n    private ui_sqnum: fgui.GTextField = null;\r\n    private ui_qrcodeNode: fgui.GLoader = null;\r\n    private ui_invitationGroup: fgui.GGroup = null;\r\n\r\n    createChildComponents() {\r\n        super.createChildComponents();\r\n        this.fguiComponent.visible = false;\r\n        this.ui_btn_CommunityBreak.onClick(this.Hide, this);\r\n        this.ui_btn_saveImg.onClick(this.saveImage, this);\r\n        this.ui_btn_copyLink.onClick(this.copyLink, this);\r\n\r\n        this.qrNode = this.ui_qrcodeNode.node;\r\n\r\n    }\r\n    OnLoadCompleted() {\r\n        this.setQRCode();\r\n        this.Show();\r\n    }\r\n    Hide() {\r\n        AudioManager.Singleton.play('ShareView', \"button\");\r\n        super.Hide();\r\n    }\r\n    Show() {\r\n        super.Show();\r\n        this.setLinkUrl();\r\n    }\r\n    private linkHost: string = \"\";\r\n    public setLinkUrl() {\r\n        if (LobbyViewCtr.instance.Model.ageninfo) {//&& LobbyViewCtr.instance.Model.ageninfo.lv <= 3\r\n            this.ui_invitationGroup.asCom.visible = true;\r\n            this.ui_sqnum.text = LobbyViewCtr.instance.Model.ageninfo.Code;\r\n        } else {\r\n            this.ui_invitationGroup.asCom.visible = false;\r\n        }\r\n    }\r\n\r\n    private qrNode: cc.Node;\r\n    public setQRCode() {\r\n        let url: string = \"\";\r\n        if (AppConst.platform == \"Android\") {\r\n            url = BaseFrameNative.serverList.apksite;\r\n        } else if (AppConst.platform == \"iOS\") {\r\n            url = BaseFrameNative.serverList.ipasite;\r\n        } else {\r\n            url = BaseFrameNative.serverList.apksite;\r\n        }\r\n        this.linkHost = url;\r\n        this.ui_shareUrl.setVar(\"host\", url).flushVars();\r\n        this.setContent(url);\r\n    }\r\n    public setContent(value: string) {\r\n        let qrcode = new QRCode(-1, 2);\r\n        qrcode.addData(value);\r\n        qrcode.make();\r\n\r\n        let size = 370;\r\n        let num = qrcode.getModuleCount();\r\n        let ctx = this.qrNode.addComponent(cc.Graphics);\r\n        ctx.clear();\r\n        ctx.fillColor = cc.Color.BLACK;\r\n        // compute tileW/tileH based on node width and height\r\n        let tileW = size / num;\r\n        let tileH = size / num;\r\n        // draw in the Graphics\r\n        for (let row = 0; row < num; row++) {\r\n            for (let col = 0; col < num; col++) {\r\n                if (qrcode.isDark(row, col)) {\r\n                    // cc.log(row, col)\r\n                    // ctx.fillColor = cc.Color.BLACK;\r\n                    let w = (Math.ceil((col + 1) * tileW) - Math.floor(col * tileW));\r\n                    let h = (Math.ceil((row + 1) * tileW) - Math.floor(row * tileW));\r\n                    ctx.rect(Math.round(col * tileW), size - tileH - Math.round(row * tileH), w, h);\r\n                    ctx.fill();\r\n                } else {\r\n                    // ctx.fillColor = cc.Color.WHITE;\r\n                }\r\n\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    /**複製鏈接 */\r\n    public copyLink() {\r\n        AudioManager.Singleton.play('ShareView', \"button\");\r\n        let linkUrl = this.linkHost;\r\n        NativeMethod.copyTextString(linkUrl);\r\n        CommonCtr.instance.view.ShowTipLabel(\"复制成功\");\r\n    }\r\n\r\n\r\n    private texture: cc.RenderTexture;\r\n    private _width;\r\n    private _height;\r\n    filpYImage(data, width, height) {\r\n        // create the data array\r\n        let picData = new Uint8Array(width * height * 4);\r\n        let rowBytes = width * 4;\r\n        for (let row = 0; row < height; row++) {\r\n            let srow = height - 1 - row;\r\n            let start = srow * width * 4;\r\n            let reStart = row * width * 4;\r\n            // save the piexls data\r\n            for (let i = 0; i < rowBytes; i++) {\r\n                picData[reStart + i] = data[start + i];\r\n            }\r\n        }\r\n        return picData;\r\n\r\n    }\r\n    initImage() {\r\n        let data = this.texture.readPixels();\r\n        //this._width = this.texture.width;\r\n        //this._height = this.texture.height;\r\n        let picData = this.filpYImage(data, this._width, this._height);\r\n        return picData;\r\n    }\r\n\r\n    /**截图 */\r\n    public saveImage() {\r\n        AudioManager.Singleton.play('ShareView', \"button\");\r\n        if (CC_JSB) {\r\n            let size = cc.view.getVisibleSize(); //cc.director.getWinSize(); cc.view.getVisibleSize()\r\n            let node = new cc.Node();\r\n            node.parent = cc.director.getScene();\r\n\r\n            let width = Math.floor(size.width);\r\n            let height = Math.floor(size.height);\r\n            this._width = width;\r\n            this._height = height;\r\n\r\n            node.width = width;\r\n            node.height = height;\r\n            node.x = size.width / 2;\r\n            node.y = size.height / 2;\r\n            let camera = node.addComponent(cc.Camera);\r\n            // 设置你想要的截图内容的 cullingMask\r\n            camera.cullingMask = 0xffffffff;\r\n            // 新建一个 RenderTexture，并且设置 camera 的 targetTexture 为新建的 RenderTexture，这样        camera 的内容将会渲染到新建的 RenderTexture 中。\r\n            let texture = new cc.RenderTexture();\r\n            this.texture = texture;\r\n            //@ts-ignore\r\n            // let gl = cc.game[\"_renderContext\"];\r\n            // console.log(\"===============\", width, height, gl.STENCIL_INDEX8)\r\n            texture.initWithSize(width, height);  //cc[\"gfx\"].RB_FMT_S8\r\n            // 如果截图内容中不包含 Mask 组件，可以不用传递第三个参数\r\n            camera.targetTexture = texture;\r\n            camera.render();\r\n            let picData = this.initImage();\r\n            this.schedule(() => {\r\n                this.createCanvas(picData);\r\n                //jsb.fileUtils.getWritablePath()     \"/sdcard/Pictures/\"\r\n                let filePath = jsb.fileUtils.getWritablePath() + 'render_to_sprite_image.png';\r\n                if (cc.sys.os == cc.sys.OS_ANDROID) {\r\n                    filePath = \"/sdcard/Pictures/render_to_sprite_image.png\";\r\n                }\r\n                //@ts-ignore\r\n                let success = jsb.saveImageData(picData, width, height, filePath)\r\n                camera.enabled = false;\r\n                camera.destroy();\r\n                node.destroy();\r\n                // if (success) {\r\n                //     console.log(\"save image data success, file: \" + filePath);\r\n                // } else {\r\n                //     console.log(\"保存失败\");\r\n                // }\r\n            }, 1, 0);\r\n        } else {\r\n            cc.director.once(cc.Director.EVENT_AFTER_DRAW, () => {\r\n                //此处开始执行截屏\r\n                const canvas = cc.game.canvas;\r\n                const base64 = canvas.toDataURL(\"image/png\");\r\n                // const href = base64.replace(/^data:image[^;]*/, \"data:image/octet-stream\");\r\n                //document.location.href = href;\r\n                let a = document.createElement(\"a\");\r\n                a.href = base64;\r\n                a.download = \"image\";\r\n                document.body.appendChild(a);\r\n                a.click();\r\n                document.body.removeChild(a);\r\n            });\r\n        }\r\n\r\n    }\r\n\r\n\r\n    createCanvas(picData) {\r\n        let texture = new cc.Texture2D();\r\n        texture.initWithData(picData, 32, this._width, this._height);\r\n\r\n        let spriteFrame = new cc.SpriteFrame();\r\n        spriteFrame.setTexture(texture);\r\n\r\n        let node = new cc.Node();\r\n        let sprite = node.addComponent(cc.Sprite);\r\n        sprite.spriteFrame = spriteFrame;\r\n\r\n        node.zIndex = cc.macro.MAX_ZINDEX;\r\n        node.parent = cc.director.getScene();\r\n        // set position\r\n        let width = cc.winSize.width;\r\n        let height = cc.winSize.height;\r\n        node.x = width / 2;\r\n        node.y = height / 2;\r\n\r\n        // node.on(cc.Node.EventType.TOUCH_START, () => {\r\n        //     node.parent = null;\r\n        //     node.destroy();\r\n        // });\r\n\r\n        this.captureAction(node, width, height);\r\n    }\r\n\r\n    captureAction(capture: cc.Node, width, height) {\r\n        let scaleAction = cc.scaleTo(1, 0.3);\r\n        let targetPos = cc.v2(width - width / 6, height / 4);\r\n        let moveAction = cc.moveTo(1, targetPos);\r\n        let spawn = cc.spawn(scaleAction, moveAction);\r\n        capture.runAction(cc.sequence(spawn, cc.delayTime(3), cc.callFunc(() => {\r\n            capture.parent = null;\r\n            capture.destroy();\r\n        })));\r\n\r\n        let blinkAction = cc.blink(0.1, 1);\r\n        // scene action\r\n        this.node.runAction(blinkAction);\r\n    }\r\n\r\n}"]}