{"version":3,"sources":["assets\\Script\\modules\\@slotsmaster\\ui-common\\lib\\ExChanged\\ExchangePanel.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["/*\n * @Description:\n * @Author: 张菊\n * @Date: 2020-06-01 17:30:18\n * @LastEditTime: 2020-07-13 15:26:04\n * @LastEditors: 张菊\n */\n\nimport { Popup } from \"../Popup\";\nimport { AppConst } from \"../AppConst\";\nimport HttpApi, { Http_GetRedeem } from \"../HttpApi\";\nimport { Utils } from \"../../../../@mogafa/utils/lib/Utils\";\n\nexport default class ExchangePanel extends Popup {\n    protected get basePanel(): string {\n        return \"base\";\n    }\n    protected get animNode(): cc.Node[] {\n        throw new Error(\"Method not implemented.\");\n    }\n    protected get buttonOKName(): string {\n        return \"closeButton\";\n    }\n    protected get goldGrowName(): string[] {\n        throw new Error(\"Method not implemented.\");\n    }\n    protected get normalNumName(): string[] {\n        throw new Error(\"Method not implemented.\");\n    }\n    protected get packageResourceName(): string {\n        return \"gameHall\";\n    }\n    protected get packageName(): string {\n        return \"res/Exchange\";\n    }\n    protected get componentName(): string {\n        return \"MainView\";\n    }\n    get closeTime(): number {\n        return -1;\n    }\n    private _redeemList = null;\n    private _backGroundSpineName: string = \"GameHall/Spine/spine_ui_popup/spine_ui_popup\";\n    private _backGroundSpine: sp.Skeleton;\n    allChildCreated() {\n        super.allChildCreated();\n    }\n    protected async createChildComponents() {\n        super.createChildComponents();\n        this.initSpine();\n    }\n    private initSpine(): void {\n        Utils.addSpine(\n            this._backGroundSpineName,\n            this._base.getChild(\"backGroundSpine\").node,\n            (backGroundSpine: sp.Skeleton) => {\n                this._backGroundSpine = backGroundSpine;\n                backGroundSpine.setCompleteListener((trackEntry: any, loopCount: number) => {\n                    var animName: string = trackEntry.animation ? trackEntry.animation.name : \"\";\n                    if (animName == \"Popup\") {\n                        backGroundSpine.setAnimation(0, \"loop\", true);\n                    }\n                });\n            }\n        );\n    }\n    private initData(callBack: Function): void {\n        this.node.emit(AppConst.IsShowLoading);\n        HttpApi.http\n            .get(HttpApi.server + Http_GetRedeem, {\n                headers: {\n                    // 'Content-Type': \"application/json\",\n                    Authorization: AppConst.accessToken,\n                },\n            })\n            .then(\n                (res: any) => {\n                    console.log(res);\n                    if (res.code == 200) {\n                        this._redeemList = res.data;\n                        console.log(\"initDatainitData:\", this._redeemList);\n                        this.node.emit(AppConst.IsShowLoading, false);\n                        callBack();\n                    }\n                },\n                (err) => {\n                    console.log(\"err\", JSON.stringify(err));\n                    this.node.emit(AppConst.IsShowLoading, false);\n                }\n            )\n            .catch((err) => {\n                console.log(\"catch\", JSON.stringify(err));\n                this.node.emit(AppConst.IsShowLoading, false);\n            });\n    }\n    private initShow(): void {\n        for (let index = 0; index < 4; index++) {\n            let data = this._redeemList.cardRedeemInfoList[index];\n            let item = this._base.getChild(index.toString()).asCom;\n            item.getChild(\"exChangeButton\").asButton.onClick(this.exChangeClick, this);\n            item.getChild(\"exChangeButton\")._id = (3 - index).toString();\n\n            item.getChild(\"detailsButton\").asButton.onClick(this.goToCardPanel, this);\n            item.getChild(\"detailsButton\")._id = (3 - index).toString();\n\n            item.getChild(\"icon\").asLoader.url = data.info.collectionIconUrl;\n            item.getChild(\"cardImage\").asLoader.url = data.info.redeemItemIconUrl;\n\n            item.getChild(\"rewardCount\").asLabel.text = \"$\" + data.info.redeemRewards.toString();\n            item.getChild(\"rewardCount1\").asLabel.text = \"$\" + data.info.redeemRewards;\n            if (index == 3) {\n                item.getChild(\"describe\").asLabel.text = \"Collect this card\";\n            }\n            item.getChild(\"num\").asLabel.text = data.info.collectedValue + \"/\" + data.info.expiredValue;\n        }\n        let item = this._base.getChild(\"4\").asCom;\n        item.getChild(\"exChangeButton\").asButton.onClick(this.exChangeClick, this);\n        item.getChild(\"exChangeButton\")._id = \"4\";\n        item.getChild(\"icon\").asLoader.url = this._redeemList.points.collectionIconUrl;\n        item.getChild(\"cardImage\").asLoader.url = this._redeemList.points.redeemItemIconUrl;\n        item.getChild(\"describe\").asLabel.text = this._redeemList.points.description;\n        item.getChild(\"rewardCount\").asLabel.text = this._redeemList.points.redeemRewards.toString();\n        item.getChild(\"rewardCount1\").asLabel.text = this._redeemList.points.redeemRewards;\n        item.getChild(\"num\").asLabel.text =\n            this._redeemList.points.collectedValue + \"/\" + this._redeemList.points.expiredValue;\n    }\n    private exChangeClick(event: any): void {\n        //请求服务器是否可以兑换  成功跳转第三方网页 失败 弹框提示\n        this.onButtonClickMusic();\n        let _id = parseInt(event.initiator.id);\n    }\n    private goToCardPanel(event: any): void {\n        this.onButtonClickMusic();\n        //跳转到对应卡组\n        let _id = parseInt(event.initiator.id);\n        this.node.emit(\"SHOWCARD\", _id);\n        this.hide();\n    }\n    hide(): void {\n        super.hide();\n    }\n    showPanel(): void {\n        this._base.getChild(\"allChildren\").visible = false;\n        let self = this;\n        this.initData(function () {\n            self.show();\n            self._backGroundSpine.setAnimation(0, \"Popup\", false);\n            self.initShow();\n            setTimeout(() => {\n                self._base.getChild(\"allChildren\").visible = true;\n            }, 1000);\n        });\n    }\n}\n"]}