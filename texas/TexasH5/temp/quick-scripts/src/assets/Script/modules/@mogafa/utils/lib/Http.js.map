{"version":3,"sources":["assets\\Script\\modules\\@mogafa\\utils\\lib\\Http.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\ninterface IRequestConfig {\n    headers?: any;\n}\ninterface HttpResponse {\n    code: number;\n    data: any;\n    isSuccessful: boolean;\n    message: string;\n}\nexport default class Http extends cc.Component {\n    private _config: IRequestConfig = {};\n    /**\n     * get请求\n     * @param {string} url\n     */\n    public get(url: string, config: IRequestConfig = {}): Promise<HttpResponse> {\n        let xhr = cc.loader.getXMLHttpRequest();\n        return new Promise((resolve, reject) => {\n            xhr.onreadystatechange = function () {\n                if (xhr.status === 200 && xhr.readyState === 4) {\n                    let response = xhr.responseText;\n                    resolve(JSON.parse(response));\n                }\n            };\n            xhr.onerror = function (err) {\n                reject(err);\n            };\n            xhr.open(\"GET\", url, true);\n            if (config && Object.keys(config).length > 0) {\n                this._config = Object.assign(this._config, config);\n            }\n            this.setXHRConfig(xhr);\n            xhr.ontimeout = function (e) {\n                reject(`connect timeout，error message：${JSON.stringify(e)}`);\n            };\n            xhr.send();\n        });\n    }\n\n    /**\n     * post请求\n     * @param {string} url\n     * @param {object} params\n     */\n    public post(url: string, params: any, config: IRequestConfig = {}): Promise<HttpResponse> {\n        return new Promise((resolve, reject) => {\n            var xhr = cc.loader.getXMLHttpRequest();\n            xhr.onreadystatechange = function () {\n                if (xhr.readyState === 4 && xhr.status === 200) {\n                    var response = xhr.responseText;\n                    resolve(JSON.parse(response));\n                }\n            };\n            xhr.onerror = function (err) {\n                reject(err);\n            };\n\n            xhr.open(\"POST\", url, true);\n            if (config && Object.keys(config).length > 0) {\n                this._config = Object.assign(this._config, config);\n            }\n            this.setXHRConfig(xhr);\n\n            xhr.ontimeout = function (e) {\n                reject(`connect timeout，error message：${JSON.stringify(e)}`);\n            };\n            xhr.send(JSON.stringify(params));\n        });\n    }\n\n    private setXHRConfig(xhr: XMLHttpRequest) {\n        // xhr.setRequestHeader(\"Access-Control-Allow-Origin\", \"*\");\n        // xhr.setRequestHeader(\"Access-Control-Allow-Methods\", \"GET, POST, PUT, DELETE\");\n        // xhr.setRequestHeader(\"Access-Control-Allow-Headers\", \"device-uuid,Authorization\");\n        // xhr.setRequestHeader(\"Content-Type\", \"application/json\");\n        if (this._config.headers) {\n            for (let i in this._config.headers) {\n                xhr.setRequestHeader(i, this._config.headers[i]);\n                console.error(this._config.headers[i] + \" ..........setXHRConfig\");\n            }\n        }\n        xhr.timeout = 8000;        // 8 seconds for timeout \n    }\n\n    public setInterceptorParams(params: IRequestConfig): void {\n        this._config = params;\n    }\n}\n"]}