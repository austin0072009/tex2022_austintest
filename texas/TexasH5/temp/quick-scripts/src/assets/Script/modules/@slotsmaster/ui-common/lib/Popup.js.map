{"version":3,"sources":["assets\\Script\\modules\\@slotsmaster\\ui-common\\lib\\Popup.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { FguiWindow } from \"../../../@mogafa/fairygui-component/lib/FguiComponentBase\";\nimport SoundMgr from \"../../../@mogafa/utils/lib/SoundMgr\";\n\nexport abstract class Popup extends FguiWindow {\n    private _normalNum: number[];\n    private _goldNum: number[];\n    private _closeTime: number = 3;\n    private callback: Function;\n    private _isHideComplete: boolean = false;\n    private _isRegisterNodeEvent: boolean = true;\n    protected _base: fgui.GComponent;\n    protected abstract get animNode(): cc.Node[]; //需要渐变动画节点\n    protected abstract get buttonOKName(): string; //点击按钮\n    protected abstract get basePanel(): string; //点击按钮\n    protected abstract get goldGrowName(): string[]; //金币文本\n    protected abstract get normalNumName(): string[]; //other\n\n    public get normalNum(): number[] {\n        return this._normalNum;\n    }\n    public set normalNum(value: number[]) {\n        if (value.length != this.normalNumName.length) cc.warn(\"other数据错误\");\n        this._normalNum = value;\n        this.normalValue();\n    }\n\n    public set goldNum(value: number[]) {\n        if (value.length != this.goldGrowName.length) cc.warn(\"gold数据错误\");\n        this._goldNum = value;\n        this.goldValue();\n    }\n\n    public get goldNum(): number[] {\n        return this._goldNum;\n    }\n\n    public set closeTime(value: number) {\n        this._closeTime = value;\n        this.openSchedule();\n    }\n\n    public get closeTime(): number {\n        return this._closeTime;\n    }\n    public set isRegisterNodeEvent(value: boolean) {\n        this._isRegisterNodeEvent = value;\n    }\n    public get isRegisterNodeEvent(): boolean {\n        return this._isRegisterNodeEvent;\n    }\n    /**\n     * 添加所有按钮的音效\n     * @param fguiComponent\n     */\n    protected addAllButtonMusic(fguiComponent: fgui.GComponent): void {\n        fguiComponent._children.map((item) => {\n            if (item.node.name === \"GButton\") {\n                item.on(fairygui.Event.TOUCH_END, this.onButtonClickMusic.bind(this));\n            }\n        });\n    }\n    /**\n     * 按钮点击播放音效事件\n     * 子类重载此方法给按钮绑定音乐\n     */\n    protected onButtonClickMusic(): void {\n        SoundMgr.getInstance().playEffect(\"button\");\n    }\n    protected createChildComponents() {\n        super.createChildComponents();\n        if (this.basePanel != \"\" && this.basePanel) {\n            this._base = this.fguiComponent.getChild(\"base\").asCom;\n            this._base.node.setAnchorPoint(0.5, 0.5);\n        }\n        this.window.hide();\n    }\n\n    allChildCreated() {\n        if (this.basePanel != \"\" && this.basePanel) {\n            this.addAllButtonMusic(this._base);\n        } else if (this.basePanel == \"\" || !this.basePanel) {\n            this.addAllButtonMusic(this.fguiComponent);\n        }\n        super.allChildCreated();\n        if (this.buttonOKName != \"\" && this.buttonOKName) {\n            if (this.basePanel != \"\" && this.basePanel) {\n                this._base.getChild(this.buttonOKName).onClick(this.hide.bind(this));\n            } else if (this.basePanel == \"\" || !this.basePanel) {\n                this.fguiComponent.getChild(this.buttonOKName).onClick(this.hide.bind(this));\n            }\n        }\n    }\n    public setIndex(): void {\n        this.window.bringToFront();\n    }\n    public show(): void {\n        this.resetBase();\n        if (this.isRegisterNodeEvent) {\n            this.fguiComponent.node.on(\"touchstart\", () => { });\n        }\n        this.window.show();\n        this.window.bringToFront();\n        this.onPlayShowAni();\n        this.openSchedule();\n    }\n\n    public hide(): void {\n        this.unschedule(this.callback);\n        this.onPlayHideAni();\n        if (this._isHideComplete) {\n            this._isHideComplete = false;\n        } else {\n            this.window.hide();\n        }\n        //! 关闭窗口时必须解除事件绑定，否则再次打开时绑定事件将不会生效\n        if (this.isRegisterNodeEvent) this.fguiComponent.node.off(\"touchstart\");\n    }\n\n    protected onPlayShowAni(): void {\n        if (this.basePanel != \"\" && this.basePanel) {\n            this._base.node.runAction(cc.scaleTo(0.2, 1, 1).easing(cc.easeIn(0.2)));\n        }\n    }\n\n    protected onPlayHideAni(): void {\n        if (this.basePanel != \"\" && this.basePanel) {\n            let self = this;\n            let callBack = cc.callFunc(function () {\n                self._isHideComplete = true;\n                self.window.hide();\n            });\n            this._base.node.runAction(cc.sequence(cc.scaleTo(0.2, 0, 0), callBack));\n        }\n    }\n    private resetBase(): void {\n        if (this.basePanel != \"\" && this.basePanel) {\n            this._base.node.setScale(0.1, 0.1);\n        }\n    }\n    private goldValue() {\n        if (this.goldNum.length < 1 || this.goldGrowName.length < 1) return;\n        if (this.goldNum.length != this.goldGrowName.length) cc.warn(\"金币数据错误\");\n        if (this.goldNum) {\n            for (let i = 0; i < this.goldNum.length; i++) {\n                if (this.goldNum[i] === 0) {\n                    this.fguiComponent.getChild(this.goldGrowName[i]).asTextField.text = \"0\";\n                } else {\n                    this.fguiComponent\n                        .getChild(this.goldGrowName[i])\n                        .asTextField.asMogafaNumberField()\n                        .play(0, this.goldNum[i], 3);\n                }\n            }\n        }\n    }\n\n    private normalValue() {\n        if (this.normalNumName.length != this.normalNum.length) cc.warn(\"other数据错误\");\n        if (this.normalNum) {\n            for (let i = 0; i < this.normalNum.length; i++) {\n                this.fguiComponent.getChild(this.normalNumName[i]).asTextField.text = String(this.normalNum[i]);\n            }\n        }\n    }\n\n    private openSchedule() {\n        this.unschedule(this.callback);\n        if (this.closeTime != -1) {\n            this.callback = function () {\n                this.hide();\n            };\n            this.scheduleOnce(this.callback, this._closeTime);\n        }\n    }\n}\n"]}