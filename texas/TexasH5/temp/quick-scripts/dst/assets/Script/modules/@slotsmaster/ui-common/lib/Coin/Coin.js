
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/modules/@slotsmaster/ui-common/lib/Coin/Coin.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'ff421AXfglPlLAyKQ1D4AIR', 'Coin');
// Script/modules/@slotsmaster/ui-common/lib/Coin/Coin.ts

"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Coin = void 0;
var FguiComponentBase_1 = require("../../../../@mogafa/fairygui-component/lib/FguiComponentBase");
var CoinSpread_1 = require("./CoinSpread");
var Coin = /** @class */ (function (_super) {
    __extends(Coin, _super);
    function Coin() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        //* 抛物线顶点最小y坐标
        _this.targetNodeMinY = -300;
        //* 抛物线顶点最大y坐标
        _this.targetNodeMaxY = 0;
        //* 金币最小速度
        _this.minspeed = 120;
        //* 金币最大速度
        _this.maxspeed = 200;
        _this._isCoinSpred = false;
        return _this;
    }
    Object.defineProperty(Coin.prototype, "packageResourceName", {
        get: function () {
            return "GameCommon";
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(Coin.prototype, "packageName", {
        get: function () {
            return "Common";
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(Coin.prototype, "componentName", {
        get: function () {
            return "Coin";
        },
        enumerable: false,
        configurable: true
    });
    Coin.prototype.createChildComponents = function () {
        _super.prototype.createChildComponents.call(this);
        this._coinSpread = new CoinSpread_1.default(this.fguiComponent.node);
        this._coinNode = this.fguiComponent.node;
    };
    Coin.prototype.update = function (dt) {
        if (this._isCoinSpred) {
            this._coinSpread.update(dt);
        }
    };
    Coin.prototype.onDestroy = function () {
        console.log("has been destroyed.");
    };
    /**
     * 金币飞行动画
     * @param startPos
     * @param endPos
     */
    Coin.prototype.coinFly = function (startPos, endPos) {
        var _this = this;
        this._isCoinSpred = false;
        this._coinNode.zIndex = 2000;
        this._coinNode.scale = 0.4;
        this._coinNode.position = cc.v3(startPos.x, startPos.y, 0);
        var randomx1 = endPos.x - startPos.x;
        var randomx2 = startPos.x - endPos.x;
        var randomy1 = endPos.y - startPos.y;
        var randomy2 = startPos.y - endPos.y;
        var q1 = cc.v2(0, 0);
        var q2 = cc.v2(0, 0);
        var romx = cc.misc.lerp(-100, 100, Math.random());
        var romy = cc.misc.lerp(-100, 100, Math.random());
        if (romx > 0) {
            q1.x = startPos.x + romx + 100;
        }
        else {
            q1.x = startPos.x + romx - 100;
        }
        if (romy > 0) {
            q1.y = startPos.y + romy + 100;
        }
        else {
            q1.y = startPos.y + romy - 100;
        }
        if (endPos.x > startPos.x) {
            q2.x = q1.x + randomx1 * Math.random();
        }
        else {
            q2.x = q1.x - randomx2 * Math.random();
        }
        if (endPos.y > startPos.y) {
            q2.y = q1.y - randomy1 * Math.random();
        }
        else {
            q2.y = q1.y + randomy2 * Math.random();
        }
        this._coinNode.runAction(cc.sequence(cc.delayTime(1), cc.fadeOut(1 / 30)));
        this._coinNode.runAction(cc.sequence(cc.bezierTo(1, [q1, q2, endPos]), cc.callFunc(function () {
            if (_this.fguiComponent.node.isValid) {
                _this.fguiComponent.node.destroy();
            }
        })));
    };
    Coin.prototype.coinFlyByCurve = function (coins, startPos, endPos) {
        var _this = this;
        if (coins % 2 !== 0) {
            if (this.fguiComponent.node.isValid) {
                this.fguiComponent.node.destroy();
            }
            return;
        }
        this._coinNode.position = cc.v3(startPos.x, startPos.y, 0);
        var radius = (endPos.y - startPos.y) / 2;
        var distance = Math.abs(endPos.y - startPos.y);
        var peak1 = cc.v2(startPos.x + radius * Math.tan(((Math.PI * 2) / 360) * 30), distance * (1 / 4) + startPos.y);
        var trough1 = cc.v2(startPos.x, startPos.y + distance / 2);
        var bezierPeak1 = [startPos, peak1, trough1];
        var peak2 = cc.v2(startPos.x - radius * Math.tan(((Math.PI * 2) / 360) * 30), distance * (3 / 4) + startPos.y);
        var trough2 = endPos;
        var bezierPeak2 = [trough1, peak2, trough2];
        this._coinNode.runAction(cc.sequence(cc.bezierTo(0.5, bezierPeak1), cc.bezierTo(0.5, bezierPeak2), cc.callFunc(function () {
            if (_this.fguiComponent.node.isValid) {
                _this.fguiComponent.node.destroy();
            }
        })));
    };
    /**
     * 金币挥洒动画
     */
    Coin.prototype.coinSpread = function () {
        this._isCoinSpred = true;
        var startX = -300;
        var startY = 600;
        var endX = 800;
        var endY = 100;
        if (Math.random() * 100 > 65) {
            this._coinNode.zIndex = 100;
        }
        else {
            this._coinNode.zIndex = 10;
        }
        var startpos;
        if (Math.floor(Math.random() * 10) % 2 == 0) {
            this.leftTargetNode = cc.v2(cc.misc.lerp(-endX, -endY, Math.random()), cc.misc.lerp(this.targetNodeMinY, this.targetNodeMaxY, Math.random()));
            startpos = cc.v2(cc.misc.lerp(-startX, 0, Math.random()), -startY);
        }
        else {
            this.leftTargetNode = cc.v2(cc.misc.lerp(endY, endX, Math.random()), cc.misc.lerp(this.targetNodeMaxY, this.targetNodeMinY, Math.random()));
            startpos = cc.v2(cc.misc.lerp(0, startX, Math.random()), -startY);
        }
        var coinspeed = cc.misc.lerp(this.minspeed, this.maxspeed, Math.random());
        this._coinSpread.coinSpread(startpos, this.leftTargetNode, coinspeed, this.coinSpreadCallback.bind(this));
    };
    /**
     * 金币挥洒动画回调
     */
    Coin.prototype.coinSpreadCallback = function () {
        if (this.fguiComponent.node.isValid) {
            this.fguiComponent.node.destroy();
            this._isCoinSpred = false;
        }
    };
    /**
     * 底部栏getCoin金币收集动画
     * @param startPos
     * @param endPos
     * @param flyTime
     */
    Coin.prototype.getCoinCollect = function (startPos, endPos, flyTime) {
        var _this = this;
        if (flyTime === void 0) { flyTime = 1; }
        this._coinNode.scale = 0.4;
        this._coinNode.position = cc.v3(startPos.x, startPos.y, 0);
        var randomx1 = endPos.x - startPos.x;
        var randomx2 = startPos.x - endPos.x;
        var randomy1 = endPos.y - startPos.y;
        var randomy2 = startPos.y - endPos.y;
        var q1 = cc.v2(0, 0);
        var q2 = cc.v2(0, 0);
        var romx = cc.misc.lerp(-100, 100, Math.random());
        var romy = cc.misc.lerp(-100, 100, Math.random());
        if (romx > 0) {
            q1.x = startPos.x + romx + 160;
        }
        else {
            q1.x = startPos.x + romx - 100;
        }
        if (romy > 0) {
            q1.y = startPos.y + romy + 400;
        }
        else {
            q1.y = startPos.y + romy + 300;
        }
        if (endPos.x > startPos.x) {
            q2.x = q1.x + randomx1 * Math.random();
        }
        else {
            q2.x = q1.x - randomx2 * Math.random();
        }
        if (endPos.y > startPos.y) {
            q2.y = q1.y - randomy1 * Math.random();
        }
        else {
            q2.y = q1.y + randomy2 * Math.random();
        }
        this._coinNode.runAction(cc.sequence(cc.delayTime(flyTime), cc.fadeOut(1 / 30)));
        this._coinNode.runAction(cc
            .sequence(cc.bezierTo(flyTime, [q1, q2, endPos]), cc.callFunc(function () {
            if (_this.fguiComponent.node.isValid) {
                _this.fguiComponent.node.destroy();
            }
        }))
            .easing(cc.easeOut(1)));
    };
    return Coin;
}(FguiComponentBase_1.default));
exports.Coin = Coin;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxtb2R1bGVzXFxAc2xvdHNtYXN0ZXJcXHVpLWNvbW1vblxcbGliXFxDb2luXFxDb2luLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFDQSxrR0FBNkY7QUFDN0YsMkNBQXNDO0FBQ3RDO0lBQTBCLHdCQUFpQjtJQUEzQztRQUFBLHFFQXFQQztRQXhPRyxjQUFjO1FBQ04sb0JBQWMsR0FBVyxDQUFDLEdBQUcsQ0FBQztRQUV0QyxjQUFjO1FBQ04sb0JBQWMsR0FBVyxDQUFDLENBQUM7UUFJbkMsVUFBVTtRQUNGLGNBQVEsR0FBVyxHQUFHLENBQUM7UUFFL0IsVUFBVTtRQUNGLGNBQVEsR0FBVyxHQUFHLENBQUM7UUFFdkIsa0JBQVksR0FBWSxLQUFLLENBQUM7O0lBME4xQyxDQUFDO0lBcFBHLHNCQUFjLHFDQUFtQjthQUFqQztZQUNJLE9BQU8sWUFBWSxDQUFDO1FBQ3hCLENBQUM7OztPQUFBO0lBQ0Qsc0JBQWMsNkJBQVc7YUFBekI7WUFDSSxPQUFPLFFBQVEsQ0FBQztRQUNwQixDQUFDOzs7T0FBQTtJQUNELHNCQUFjLCtCQUFhO2FBQTNCO1lBQ0ksT0FBTyxNQUFNLENBQUM7UUFDbEIsQ0FBQzs7O09BQUE7SUFvQlMsb0NBQXFCLEdBQS9CO1FBQ0ksaUJBQU0scUJBQXFCLFdBQUUsQ0FBQztRQUM5QixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksb0JBQVUsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzNELElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUM7SUFDN0MsQ0FBQztJQUVELHFCQUFNLEdBQU4sVUFBTyxFQUFVO1FBQ2IsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFO1lBQ25CLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQy9CO0lBQ0wsQ0FBQztJQUVELHdCQUFTLEdBQVQ7UUFDSSxPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQixDQUFDLENBQUM7SUFDdkMsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxzQkFBTyxHQUFQLFVBQVEsUUFBaUIsRUFBRSxNQUFlO1FBQTFDLGlCQXNEQztRQXJERyxJQUFJLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQztRQUMxQixJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7UUFDN0IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDO1FBQzNCLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRTNELElBQUksUUFBUSxHQUFHLE1BQU0sQ0FBQyxDQUFDLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQztRQUVyQyxJQUFJLFFBQVEsR0FBRyxRQUFRLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFFckMsSUFBSSxRQUFRLEdBQUcsTUFBTSxDQUFDLENBQUMsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBRXJDLElBQUksUUFBUSxHQUFHLFFBQVEsQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUVyQyxJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNyQixJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNyQixJQUFJLElBQUksR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7UUFFbEQsSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBRWxELElBQUksSUFBSSxHQUFHLENBQUMsRUFBRTtZQUNWLEVBQUUsQ0FBQyxDQUFDLEdBQUcsUUFBUSxDQUFDLENBQUMsR0FBRyxJQUFJLEdBQUcsR0FBRyxDQUFDO1NBQ2xDO2FBQU07WUFDSCxFQUFFLENBQUMsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxDQUFDLEdBQUcsSUFBSSxHQUFHLEdBQUcsQ0FBQztTQUNsQztRQUVELElBQUksSUFBSSxHQUFHLENBQUMsRUFBRTtZQUNWLEVBQUUsQ0FBQyxDQUFDLEdBQUcsUUFBUSxDQUFDLENBQUMsR0FBRyxJQUFJLEdBQUcsR0FBRyxDQUFDO1NBQ2xDO2FBQU07WUFDSCxFQUFFLENBQUMsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxDQUFDLEdBQUcsSUFBSSxHQUFHLEdBQUcsQ0FBQztTQUNsQztRQUVELElBQUksTUFBTSxDQUFDLENBQUMsR0FBRyxRQUFRLENBQUMsQ0FBQyxFQUFFO1lBQ3ZCLEVBQUUsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsR0FBRyxRQUFRLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1NBQzFDO2FBQU07WUFDSCxFQUFFLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEdBQUcsUUFBUSxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztTQUMxQztRQUVELElBQUksTUFBTSxDQUFDLENBQUMsR0FBRyxRQUFRLENBQUMsQ0FBQyxFQUFFO1lBQ3ZCLEVBQUUsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsR0FBRyxRQUFRLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1NBQzFDO2FBQU07WUFDSCxFQUFFLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEdBQUcsUUFBUSxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztTQUMxQztRQUNELElBQUksQ0FBQyxTQUFTLENBQUMsU0FB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LEdBQUcsQ0FBQyxFQUFFO1lBQ1YsRUFBRSxDQUFDLENBQUMsR0FBRyxRQUFRLENBQUMsQ0FBQyxHQUFHLElBQUksR0FBRyxHQUFHLENBQUM7U0FDbEM7YUFBTTtZQUNILEVBQUUsQ0FBQyxDQUFDLEdBQUcsUUFBUSxDQUFDLENBQUMsR0FBRyxJQUFJLEdBQUcsR0FBRyxDQUFDO1NBQ2xDO1FBRUQsSUFBSSxJQUFJLEdBQUcsQ0FBQyxFQUFFO1lBQ1YsRUFBRSxDQUFDLENBQUMsR0FBRyxRQUFRLENBQUMsQ0FBQyxHQUFHLElBQUksR0FBRyxHQUFHLENBQUM7U0FDbEM7YUFBTTtZQUNILEVBQUUsQ0FBQyxDQUFDLEdBQUcsUUFBUSxDQUFDLENBQUMsR0FBRyxJQUFJLEdBQUcsR0FBRyxDQUFDO1NBQ2xDO1FBRUQsSUFBSSxNQUFNLENBQUMsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxDQUFDLEVBQUU7WUFDdkIsRUFBRSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxHQUFHLFFBQVEsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7U0FDMUM7YUFBTTtZQUNILEVBQUUsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsR0FBRyxRQUFRLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1NBQzFDO1FBRUQsSUFBSSxNQUFNLENBQUMsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxDQUFDLEVBQUU7WUFDdkIsRUFBRSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxHQUFHLFFBQVEsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7U0FDMUM7YUFBTTtZQUNILEVBQUUsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsR0FBRyxRQUFRLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1NBQzFDO1FBQ0QsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxFQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNqRixJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FDcEIsRUFBRTthQUNHLFFBQVEsQ0FDTCxFQUFFLENBQUMsUUFBUSxDQUFDLE9BQU8sRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsTUFBTSxDQUFDLENBQUMsRUFDdEMsRUFBRSxDQUFDLFFBQVEsQ0FBQztZQUNSLElBQUksS0FBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFO2dCQUNqQyxLQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQzthQUNyQztRQUNMLENBQUMsQ0FBQyxDQUNMO2FBQ0EsTUFBTSxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FDN0IsQ0FBQztJQUNOLENBQUM7SUFDTCxXQUFDO0FBQUQsQ0FyUEEsQUFxUEMsQ0FyUHlCLDJCQUFpQixHQXFQMUM7QUFyUFksb0JBQUkiLCJmaWxlIjoiIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCBGZ3VpQ29tcG9uZW50QmFzZSBmcm9tIFwiLi4vLi4vLi4vLi4vQG1vZ2FmYS9mYWlyeWd1aS1jb21wb25lbnQvbGliL0ZndWlDb21wb25lbnRCYXNlXCI7XG5pbXBvcnQgQ29pblNwcmVhZCBmcm9tIFwiLi9Db2luU3ByZWFkXCI7XG5leHBvcnQgY2xhc3MgQ29pbiBleHRlbmRzIEZndWlDb21wb25lbnRCYXNlIHtcbiAgICBwcm90ZWN0ZWQgZ2V0IHBhY2thZ2VSZXNvdXJjZU5hbWUoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIFwiR2FtZUNvbW1vblwiO1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgZ2V0IHBhY2thZ2VOYW1lKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBcIkNvbW1vblwiO1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgZ2V0IGNvbXBvbmVudE5hbWUoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIFwiQ29pblwiO1xuICAgIH1cblxuICAgIHByaXZhdGUgX2NvaW5TcHJlYWQ6IENvaW5TcHJlYWQ7XG5cbiAgICAvLyog5oqb54mp57q/6aG254K55pyA5bCPeeWdkOagh1xuICAgIHByaXZhdGUgdGFyZ2V0Tm9kZU1pblk6IG51bWJlciA9IC0zMDA7XG5cbiAgICAvLyog5oqb54mp57q/6aG254K55pyA5aSneeWdkOagh1xuICAgIHByaXZhdGUgdGFyZ2V0Tm9kZU1heFk6IG51bWJlciA9IDA7XG5cbiAgICBwcml2YXRlIGxlZnRUYXJnZXROb2RlOiBjYy5WZWMyO1xuXG4gICAgLy8qIOmHkeW4geacgOWwj+mAn+W6plxuICAgIHByaXZhdGUgbWluc3BlZWQ6IG51bWJlciA9IDEyMDtcblxuICAgIC8vKiDph5HluIHmnIDlpKfpgJ/luqZcbiAgICBwcml2YXRlIG1heHNwZWVkOiBudW1iZXIgPSAyMDA7XG4gICAgcHJpdmF0ZSBfY29pbk5vZGU6IGNjLk5vZGU7XG4gICAgcHJpdmF0ZSBfaXNDb2luU3ByZWQ6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIHByb3RlY3RlZCBjcmVhdGVDaGlsZENvbXBvbmVudHMoKSB7XG4gICAgICAgIHN1cGVyLmNyZWF0ZUNoaWxkQ29tcG9uZW50cygpO1xuICAgICAgICB0aGlzLl9jb2luU3ByZWFkID0gbmV3IENvaW5TcHJlYWQodGhpcy5mZ3VpQ29tcG9uZW50Lm5vZGUpO1xuICAgICAgICB0aGlzLl9jb2luTm9kZSA9IHRoaXMuZmd1aUNvbXBvbmVudC5ub2RlO1xuICAgIH1cblxuICAgIHVwZGF0ZShkdDogbnVtYmVyKSB7XG4gICAgICAgIGlmICh0aGlzLl9pc0NvaW5TcHJlZCkge1xuICAgICAgICAgICAgdGhpcy5fY29pblNwcmVhZC51cGRhdGUoZHQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgb25EZXN0cm95KCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcImhhcyBiZWVuIGRlc3Ryb3llZC5cIik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog6YeR5biB6aOe6KGM5Yqo55S7XG4gICAgICogQHBhcmFtIHN0YXJ0UG9zXG4gICAgICogQHBhcmFtIGVuZFBvc1xuICAgICAqL1xuICAgIGNvaW5GbHkoc3RhcnRQb3M6IGNjLlZlYzIsIGVuZFBvczogY2MuVmVjMikge1xuICAgICAgICB0aGlzLl9pc0NvaW5TcHJlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9jb2luTm9kZS56SW5kZXggPSAyMDAwO1xuICAgICAgICB0aGlzLl9jb2luTm9kZS5zY2FsZSA9IDAuNDtcbiAgICAgICAgdGhpcy5fY29pbk5vZGUucG9zaXRpb24gPSBjYy52MyhzdGFydFBvcy54LCBzdGFydFBvcy55LCAwKTtcblxuICAgICAgICBsZXQgcmFuZG9teDEgPSBlbmRQb3MueCAtIHN0YXJ0UG9zLng7XG5cbiAgICAgICAgbGV0IHJhbmRvbXgyID0gc3RhcnRQb3MueCAtIGVuZFBvcy54O1xuXG4gICAgICAgIGxldCByYW5kb215MSA9IGVuZFBvcy55IC0gc3RhcnRQb3MueTtcblxuICAgICAgICBsZXQgcmFuZG9teTIgPSBzdGFydFBvcy55IC0gZW5kUG9zLnk7XG5cbiAgICAgICAgbGV0IHExID0gY2MudjIoMCwgMCk7XG4gICAgICAgIGxldCBxMiA9IGNjLnYyKDAsIDApO1xuICAgICAgICBsZXQgcm9teCA9IGNjLm1pc2MubGVycCgtMTAwLCAxMDAsIE1hdGgucmFuZG9tKCkpO1xuXG4gICAgICAgIGxldCByb215ID0gY2MubWlzYy5sZXJwKC0xMDAsIDEwMCwgTWF0aC5yYW5kb20oKSk7XG5cbiAgICAgICAgaWYgKHJvbXggPiAwKSB7XG4gICAgICAgICAgICBxMS54ID0gc3RhcnRQb3MueCArIHJvbXggKyAxMDA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBxMS54ID0gc3RhcnRQb3MueCArIHJvbXggLSAxMDA7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocm9teSA+IDApIHtcbiAgICAgICAgICAgIHExLnkgPSBzdGFydFBvcy55ICsgcm9teSArIDEwMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHExLnkgPSBzdGFydFBvcy55ICsgcm9teSAtIDEwMDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChlbmRQb3MueCA+IHN0YXJ0UG9zLngpIHtcbiAgICAgICAgICAgIHEyLnggPSBxMS54ICsgcmFuZG9teDEgKiBNYXRoLnJhbmRvbSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcTIueCA9IHExLnggLSByYW5kb214MiAqIE1hdGgucmFuZG9tKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZW5kUG9zLnkgPiBzdGFydFBvcy55KSB7XG4gICAgICAgICAgICBxMi55ID0gcTEueSAtIHJhbmRvbXkxICogTWF0aC5yYW5kb20oKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHEyLnkgPSBxMS55ICsgcmFuZG9teTIgKiBNYXRoLnJhbmRvbSgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2NvaW5Ob2RlLnJ1bkFjdGlvbihjYy5zZXF1ZW5jZShjYy5kZWxheVRpbWUoMSksIGNjLmZhZGVPdXQoMSAvIDMwKSkpO1xuICAgICAgICB0aGlzLl9jb2luTm9kZS5ydW5BY3Rpb24oXG4gICAgICAgICAgICBjYy5zZXF1ZW5jZShcbiAgICAgICAgICAgICAgICBjYy5iZXppZXJUbygxLCBbcTEsIHEyLCBlbmRQb3NdKSxcbiAgICAgICAgICAgICAgICBjYy5jYWxsRnVuYygoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZndWlDb21wb25lbnQubm9kZS5pc1ZhbGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZndWlDb21wb25lbnQubm9kZS5kZXN0cm95KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIGNvaW5GbHlCeUN1cnZlKGNvaW5zOiBudW1iZXIsIHN0YXJ0UG9zOiBjYy5WZWMyLCBlbmRQb3M6IGNjLlZlYzIpIHtcbiAgICAgICAgaWYgKGNvaW5zICUgMiAhPT0gMCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZmd1aUNvbXBvbmVudC5ub2RlLmlzVmFsaWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZndWlDb21wb25lbnQubm9kZS5kZXN0cm95KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fY29pbk5vZGUucG9zaXRpb24gPSBjYy52MyhzdGFydFBvcy54LCBzdGFydFBvcy55LCAwKTtcbiAgICAgICAgbGV0IHJhZGl1czogbnVtYmVyID0gKGVuZFBvcy55IC0gc3RhcnRQb3MueSkgLyAyO1xuICAgICAgICBsZXQgZGlzdGFuY2U6IG51bWJlciA9IE1hdGguYWJzKGVuZFBvcy55IC0gc3RhcnRQb3MueSk7XG4gICAgICAgIGxldCBwZWFrMTogY2MuVmVjMiA9IGNjLnYyKFxuICAgICAgICAgICAgc3RhcnRQb3MueCArIHJhZGl1cyAqIE1hdGgudGFuKCgoTWF0aC5QSSAqIDIpIC8gMzYwKSAqIDMwKSxcbiAgICAgICAgICAgIGRpc3RhbmNlICogKDEgLyA0KSArIHN0YXJ0UG9zLnlcbiAgICAgICAgKTtcbiAgICAgICAgbGV0IHRyb3VnaDE6IGNjLlZlYzIgPSBjYy52MihzdGFydFBvcy54LCBzdGFydFBvcy55ICsgZGlzdGFuY2UgLyAyKTtcbiAgICAgICAgbGV0IGJlemllclBlYWsxOiBjYy5WZWMyW10gPSBbc3RhcnRQb3MsIHBlYWsxLCB0cm91Z2gxXTtcbiAgICAgICAgbGV0IHBlYWsyOiBjYy5WZWMyID0gY2MudjIoXG4gICAgICAgICAgICBzdGFydFBvcy54IC0gcmFkaXVzICogTWF0aC50YW4oKChNYXRoLlBJICogMikgLyAzNjApICogMzApLFxuICAgICAgICAgICAgZGlzdGFuY2UgKiAoMyAvIDQpICsgc3RhcnRQb3MueVxuICAgICAgICApO1xuICAgICAgICBsZXQgdHJvdWdoMjogY2MuVmVjMiA9IGVuZFBvcztcbiAgICAgICAgbGV0IGJlemllclBlYWsyOiBjYy5WZWMyW10gPSBbdHJvdWdoMSwgcGVhazIsIHRyb3VnaDJdO1xuICAgICAgICB0aGlzLl9jb2luTm9kZS5ydW5BY3Rpb24oXG4gICAgICAgICAgICBjYy5zZXF1ZW5jZShcbiAgICAgICAgICAgICAgICBjYy5iZXppZXJUbygwLjUsIGJlemllclBlYWsxKSxcbiAgICAgICAgICAgICAgICBjYy5iZXppZXJUbygwLjUsIGJlemllclBlYWsyKSxcbiAgICAgICAgICAgICAgICBjYy5jYWxsRnVuYygoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZndWlDb21wb25lbnQubm9kZS5pc1ZhbGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZndWlDb21wb25lbnQubm9kZS5kZXN0cm95KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOmHkeW4geaMpea0kuWKqOeUu1xuICAgICAqL1xuICAgIGNvaW5TcHJlYWQoKSB7XG4gICAgICAgIHRoaXMuX2lzQ29pblNwcmVkID0gdHJ1ZTtcbiAgICAgICAgbGV0IHN0YXJ0WDogbnVtYmVyID0gLTMwMDtcbiAgICAgICAgbGV0IHN0YXJ0WTogbnVtYmVyID0gNjAwO1xuICAgICAgICBsZXQgZW5kWDogbnVtYmVyID0gODAwO1xuICAgICAgICBsZXQgZW5kWTogbnVtYmVyID0gMTAwO1xuXG4gICAgICAgIGlmIChNYXRoLnJhbmRvbSgpICogMTAwID4gNjUpIHtcbiAgICAgICAgICAgIHRoaXMuX2NvaW5Ob2RlLnpJbmRleCA9IDEwMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX2NvaW5Ob2RlLnpJbmRleCA9IDEwO1xuICAgICAgICB9XG4gICAgICAgIGxldCBzdGFydHBvczogY2MuVmVjMjtcbiAgICAgICAgaWYgKE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKSAlIDIgPT0gMCkge1xuICAgICAgICAgICAgdGhpcy5sZWZ0VGFyZ2V0Tm9kZSA9IGNjLnYyKFxuICAgICAgICAgICAgICAgIGNjLm1pc2MubGVycCgtZW5kWCwgLWVuZFksIE1hdGgucmFuZG9tKCkpLFxuICAgICAgICAgICAgICAgIGNjLm1pc2MubGVycCh0aGlzLnRhcmdldE5vZGVNaW5ZLCB0aGlzLnRhcmdldE5vZGVNYXhZLCBNYXRoLnJhbmRvbSgpKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHN0YXJ0cG9zID0gY2MudjIoY2MubWlzYy5sZXJwKC1zdGFydFgsIDAsIE1hdGgucmFuZG9tKCkpLCAtc3RhcnRZKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubGVmdFRhcmdldE5vZGUgPSBjYy52MihcbiAgICAgICAgICAgICAgICBjYy5taXNjLmxlcnAoZW5kWSwgZW5kWCwgTWF0aC5yYW5kb20oKSksXG4gICAgICAgICAgICAgICAgY2MubWlzYy5sZXJwKHRoaXMudGFyZ2V0Tm9kZU1heFksIHRoaXMudGFyZ2V0Tm9kZU1pblksIE1hdGgucmFuZG9tKCkpXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgc3RhcnRwb3MgPSBjYy52MihjYy5taXNjLmxlcnAoMCwgc3RhcnRYLCBNYXRoLnJhbmRvbSgpKSwgLXN0YXJ0WSk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGNvaW5zcGVlZCA9IGNjLm1pc2MubGVycCh0aGlzLm1pbnNwZWVkLCB0aGlzLm1heHNwZWVkLCBNYXRoLnJhbmRvbSgpKTtcbiAgICAgICAgdGhpcy5fY29pblNwcmVhZC5jb2luU3ByZWFkKHN0YXJ0cG9zLCB0aGlzLmxlZnRUYXJnZXROb2RlLCBjb2luc3BlZWQsIHRoaXMuY29pblNwcmVhZENhbGxiYWNrLmJpbmQodGhpcykpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOmHkeW4geaMpea0kuWKqOeUu+Wbnuiwg1xuICAgICAqL1xuICAgIHByaXZhdGUgY29pblNwcmVhZENhbGxiYWNrKCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5mZ3VpQ29tcG9uZW50Lm5vZGUuaXNWYWxpZCkge1xuICAgICAgICAgICAgdGhpcy5mZ3VpQ29tcG9uZW50Lm5vZGUuZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy5faXNDb2luU3ByZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOW6lemDqOagj2dldENvaW7ph5HluIHmlLbpm4bliqjnlLtcbiAgICAgKiBAcGFyYW0gc3RhcnRQb3NcbiAgICAgKiBAcGFyYW0gZW5kUG9zXG4gICAgICogQHBhcmFtIGZseVRpbWVcbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0Q29pbkNvbGxlY3Qoc3RhcnRQb3M6IGNjLlZlYzIsIGVuZFBvczogY2MuVmVjMiwgZmx5VGltZTogbnVtYmVyID0gMSk6IHZvaWQge1xuICAgICAgICB0aGlzLl9jb2luTm9kZS5zY2FsZSA9IDAuNDtcbiAgICAgICAgdGhpcy5fY29pbk5vZGUucG9zaXRpb24gPSBjYy52MyhzdGFydFBvcy54LCBzdGFydFBvcy55LCAwKTtcblxuICAgICAgICBsZXQgcmFuZG9teDEgPSBlbmRQb3MueCAtIHN0YXJ0UG9zLng7XG5cbiAgICAgICAgbGV0IHJhbmRvbXgyID0gc3RhcnRQb3MueCAtIGVuZFBvcy54O1xuXG4gICAgICAgIGxldCByYW5kb215MSA9IGVuZFBvcy55IC0gc3RhcnRQb3MueTtcblxuICAgICAgICBsZXQgcmFuZG9teTIgPSBzdGFydFBvcy55IC0gZW5kUG9zLnk7XG5cbiAgICAgICAgbGV0IHExID0gY2MudjIoMCwgMCk7XG4gICAgICAgIGxldCBxMiA9IGNjLnYyKDAsIDApO1xuICAgICAgICBsZXQgcm9teCA9IGNjLm1pc2MubGVycCgtMTAwLCAxMDAsIE1hdGgucmFuZG9tKCkpO1xuXG4gICAgICAgIGxldCByb215ID0gY2MubWlzYy5sZXJwKC0xMDAsIDEwMCwgTWF0aC5yYW5kb20oKSk7XG5cbiAgICAgICAgaWYgKHJvbXggPiAwKSB7XG4gICAgICAgICAgICBxMS54ID0gc3RhcnRQb3MueCArIHJvbXggKyAxNjA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBxMS54ID0gc3RhcnRQb3MueCArIHJvbXggLSAxMDA7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocm9teSA+IDApIHtcbiAgICAgICAgICAgIHExLnkgPSBzdGFydFBvcy55ICsgcm9teSArIDQwMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHExLnkgPSBzdGFydFBvcy55ICsgcm9teSArIDMwMDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChlbmRQb3MueCA+IHN0YXJ0UG9zLngpIHtcbiAgICAgICAgICAgIHEyLnggPSBxMS54ICsgcmFuZG9teDEgKiBNYXRoLnJhbmRvbSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcTIueCA9IHExLnggLSByYW5kb214MiAqIE1hdGgucmFuZG9tKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZW5kUG9zLnkgPiBzdGFydFBvcy55KSB7XG4gICAgICAgICAgICBxMi55ID0gcTEueSAtIHJhbmRvbXkxICogTWF0aC5yYW5kb20oKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHEyLnkgPSBxMS55ICsgcmFuZG9teTIgKiBNYXRoLnJhbmRvbSgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2NvaW5Ob2RlLnJ1bkFjdGlvbihjYy5zZXF1ZW5jZShjYy5kZWxheVRpbWUoZmx5VGltZSksIGNjLmZhZGVPdXQoMSAvIDMwKSkpO1xuICAgICAgICB0aGlzLl9jb2luTm9kZS5ydW5BY3Rpb24oXG4gICAgICAgICAgICBjY1xuICAgICAgICAgICAgICAgIC5zZXF1ZW5jZShcbiAgICAgICAgICAgICAgICAgICAgY2MuYmV6aWVyVG8oZmx5VGltZSwgW3ExLCBxMiwgZW5kUG9zXSksXG4gICAgICAgICAgICAgICAgICAgIGNjLmNhbGxGdW5jKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZndWlDb21wb25lbnQubm9kZS5pc1ZhbGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mZ3VpQ29tcG9uZW50Lm5vZGUuZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAuZWFzaW5nKGNjLmVhc2VPdXQoMSkpXG4gICAgICAgICk7XG4gICAgfVxufVxuIl19